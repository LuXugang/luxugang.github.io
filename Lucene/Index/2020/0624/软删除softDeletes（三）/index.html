<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Lu Xugang">
    
    <title>
        
            è½¯åˆ é™¤softDeletesï¼ˆä¸‰ï¼‰ï¼ˆLucene 8.4.0ï¼‰ |
        
        Lu Xugangçš„å°å±‹
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/logo.svg">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en","path":"search.json"}
    KEEP.theme_config = {"base_info":{"title":"Lu Xugangçš„å°å±‹","author":"Lu Xugang","primary_color":"#0066cc","logo":"/images/koala.jpg","favicon":"/images/logo.svg","avatar":"/images/luxugang.jpg"},"first_screen":{"enable":true,"header_transparent":true,"background_img":"/images/bg.svg","description":"æ˜æœˆå‡ æ—¶æœ‰ æŠŠé…’é—®é’å¤©||ä¸çŸ¥é“å¤©ä¸Šå®«é˜™ ä»Šå¤•æ˜¯ä½•å¹´","hitokoto":false},"scroll":{"progress_bar":true,"percent":false},"menu":{"é¦–é¡µ":"/","å½’æ¡£":"/archives","æ ‡ç­¾":"/tags","åˆ†ç±»":"/categories","å…³äº":"/about"},"social_contact":{"enable":true,"links":{"github":"https://github.com/LuXugang","weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":"https://twitter.com/luxugang87","facebook":null,"email":"luxugang@apache.org"}},"home":{"announcement":"æ–‡ç« å†…çš„æ ‡é¢˜æ€ä¹ˆéƒ½é å³å¯¹é½æ˜¾ç¤ºäº†ï¼Œè¿™æ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ","category":true,"tag":true,"post_datetime":"created","post_datetime_format":"YYYY-MM-DD HH:mm:ss"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":true,"min2read":false},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":false,"share":true,"reward":{"enable":true,"img_link":"/images/buymeacoffee.jpg","text":"Buy me a coffee"}},"code_block":{"tools":{"enable":true,"style":"mac"},"highlight_theme":"obsidian"},"toc":{"enable":true,"number":true,"expand_all":false,"init_open":true,"layout":"left"},"website_count":{"busuanzi_count":{"enable":true,"site_uv":true,"site_pv":"ture","page_pv":true}},"local_search":{"enable":true,"preload":true},"comment":{"enable":true,"use":"giscus","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":"luxugang","github_admins":null,"repository":"luxugang-comments","client_id":"854bbd89fef1537d3af5","client_secret":"dc309b20e38535d86307f485f575855a93bf766b","proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.36"},"waline":{"server_url":null,"reaction":false,"version":"3.2.1"},"giscus":{"repo":"LuXugang/luxugang.github.io","repo_id":"R_kgDOKY7V7g","category":"Announcements","category_id":"DIC_kwDOKY7V7s4CaCS9","reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":false},"cdn":{"enable":false,"provider":"jsdelivr"},"pjax":{"enable":false},"footer":{"since":2018,"word_count":true,"icp":{"enable":true,"record_code":"è‹ICPå¤‡18064214å·-1","url":"https://beian.miit.gov.cn"},"site_deploy":{"enable":true,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":false,"css":[null],"js":[null]},"root":"","source_data":{},"version":"4.1.3"}
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"}
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"}
    KEEP.language_copy_copyright = {"copy":"Copy copyright info","copied":"Copied","title":"Original post title","author":"Original post author","link":"Original post link"}
  </script>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/koala.jpg">
                </a>
            
            <a class="site-name border-box" href="/">
               Lu Xugangçš„å°å±‹
            </a>
        </div>

        <div class="right border-box">
            <div class="pc">
                <ul class="menu-list">
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                
                                é¦–é¡µ
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                
                                å½’æ¡£
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                
                                æ ‡ç­¾
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                
                                åˆ†ç±»
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                
                                å…³äº
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/"
                    >é¦–é¡µ</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives"
                    >å½’æ¡£</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags"
                    >æ ‡ç­¾</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories"
                    >åˆ†ç±»</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about"
                    >å…³äº</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        è½¯åˆ é™¤softDeletesï¼ˆä¸‰ï¼‰ï¼ˆLucene 8.4.0ï¼‰
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/luxugang.jpg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">Lu Xugang</span>
                                
                                    <span class="author-badge">Lv6</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2020-06-24 00:00:00</span>
            </span>

            <span class="meta-info-item post-update-date">
                <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                <span class="datetime" data-updated="Fri Sep 29 2023 23:14:44 GMT+0800">2023-09-29 23:14:44</span>
            </span>
        

        
            <span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="post-category-ul">
                    
                            <li class="category-item"><a href="/categories/Lucene/">Lucene</a></li>
                        
                    
                            <li class="category-item">&nbsp;<i class="icon fas fa-angle-right"></i>&nbsp;<a href="/categories/Lucene/Index/">Index</a></li>
                        
                    
                </ul>
            </span>
        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/delete/">delete</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/softDeletes/">softDeletes</a></li>
                        
                    
                </ul>
            </span>
        

        
        
            <span class="meta-info-item post-wordcount">
                <i class="icon fas fa-file-word"></i>&nbsp;<span>3k Words</span>
            </span>
        
        
        
            <span class="meta-info-item post-pv">
                <i class="icon fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
            </span>
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    <p>â€ƒâ€ƒåœ¨æ–‡ç« <a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/Index/2020/0621/%E8%BD%AF%E5%88%A0%E9%99%A4softDeletes%EF%BC%88%E4%BA%8C%EF%BC%89" >è½¯åˆ é™¤softDeletesï¼ˆäºŒï¼‰<i class="fas fa-external-link-alt"></i></a>ä¸­æˆ‘ä»¬è¯´åˆ°ï¼Œåœ¨Lucene 7.5.0ç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨äº†ä¸‹é¢ä¸¤ä¸ªå®¹å™¨æ¥å­˜å‚¨è½¯åˆ é™¤çš„åˆ é™¤ä¿¡æ¯ã€DocValuesçš„æ›´æ–°ä¿¡æ¯ï¼š</p>
<ul>
<li>Map&lt;String,LinkedHashMap&lt;Term,NumericDocValuesUpdate&gt;&gt; numericUpdatesï¼šDocValuesUpdatesNode</li>
<li>Map&lt;String,LinkedHashMap&lt;Term,BinaryDocValuesUpdate&gt;&gt; binaryUpdateï¼šDocValuesUpdatesNode</li>
</ul>
<p>â€ƒâ€ƒè€Œä»Lucene 7.7.0ç‰ˆæœ¬ä¹‹åï¼Œä½¿ç”¨äº†ä¸‹é¢çš„ä¸€ä¸ªå®¹å™¨æ¥ä¼˜åŒ–å­˜å‚¨ï¼š</p>
<ul>
<li>final Map&lt;String, FieldUpdatesBuffer&gt; fieldUpdates = new HashMap&lt;&gt;();</li>
</ul>
<p>â€ƒâ€ƒæˆ‘ä»¬å…ˆç»™å‡ºæºç çš„CHANGE.LOGä¸­çš„ä»‹ç»ï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LUCENE-8590: BufferedUpdates now uses an optimized storage for buffering docvalues updates that can safe up to 80% of the heap used compared to the previous implementation and uses non-object based datastructures.</span><br></pre></td></tr></table></figure>
<p>â€ƒâ€ƒè¯¥issueçš„åœ°å€è§ï¼š<a class="link"   target="_blank" rel="noopener" href="https://issues.apache.org/jira/browse/LUCENE-8590" >https://issues.apache.org/jira/browse/LUCENE-8590<i class="fas fa-external-link-alt"></i></a> ï¼Œå¯¹äºä¸Šè¿°ä¸­ä¼˜åŒ–å­˜å‚¨çš„å†…å®¹å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­å±•å¼€ã€‚</p>
<p>â€ƒâ€ƒåœ¨ä»‹ç»è½¯åˆ é™¤åœ¨flush/commité˜¶æ®µçš„ç›¸å…³å†…å®¹ä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆé‡æ–°ä»‹ç»åœ¨å¤šçº¿ç¨‹ä¸‹æ‰§è¡Œæ–‡æ¡£åˆ é™¤ï¼ˆæ›´æ–°ï¼‰æ“ä½œæ—¶ï¼Œåˆ é™¤ç»“ç‚¹ï¼ˆå³<a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/Index/2020/0621/%E8%BD%AF%E5%88%A0%E9%99%A4softDeletes%EF%BC%88%E4%BA%8C%EF%BC%89" >è½¯åˆ é™¤softDeletesï¼ˆäºŒï¼‰<i class="fas fa-external-link-alt"></i></a>ä¸­ä»‹ç»çš„Nodeå¯¹è±¡ï¼‰å¦‚ä½•è¢«æ·»åŠ åˆ°å…¨å±€çš„deleteQueueä¸­ï¼Œä»¥åŠåœ¨flushé˜¶æ®µï¼ŒDWPTï¼ˆè§æ–‡ç« <a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/Index/2019/0701/%E6%96%87%E6%A1%A3%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%EF%BC%88%E4%B8%89%EF%BC%89" >æ–‡æ¡£çš„å¢åˆ æ”¹ï¼ˆä¸‰ï¼‰<i class="fas fa-external-link-alt"></i></a>ï¼‰ç”Ÿæˆä¸€ä¸ªæ®µæ—¶ï¼Œå¦‚ä½•æœ€ç»ˆç¡®å®šè¿™ä¸ªæ®µåŒ…å«äº†å“ªäº›ç§æœ‰åˆ é™¤ä¿¡æ¯ï¼ˆè§æ–‡ç« <a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/Index/2019/0725/%E6%96%87%E6%A1%A3%E6%8F%90%E4%BA%A4%E4%B9%8Bflush%EF%BC%88%E4%B8%89%EF%BC%89" >æ–‡æ¡£æäº¤ä¹‹flushï¼ˆä¸‰ï¼‰<i class="fas fa-external-link-alt"></i></a>ï¼‰ã€‚</p>
<h2 id="æ·»åŠ åˆ é™¤ç»“ç‚¹åˆ°å…¨å±€deletequeue"><a class="markdownIt-Anchor" href="#æ·»åŠ åˆ é™¤ç»“ç‚¹åˆ°å…¨å±€deletequeue"></a> æ·»åŠ åˆ é™¤ç»“ç‚¹åˆ°å…¨å±€deleteQueue</h2>
<p>â€ƒâ€ƒåœ¨è§¦å‘ä¸»åŠ¨flushï¼ˆè§æ–‡ç« <a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/Index/2019/0716/%E6%96%87%E6%A1%A3%E6%8F%90%E4%BA%A4%E4%B9%8Bflush%EF%BC%88%E4%B8%80%EF%BC%89" >æ–‡æ¡£æäº¤ä¹‹flushï¼ˆä¸€ï¼‰<i class="fas fa-external-link-alt"></i></a>ï¼‰ä¹‹å‰ï¼Œæ€»æ˜¯<strong>åªå­˜åœ¨ä¸€ä¸ª</strong>å…¨å±€çš„deleteQueueï¼Œå®ƒç”¨æ¥å­˜å‚¨åœ¨ä¸Šä¸€æ¬¡ä¸»åŠ¨flushåˆ°ä¸‹ä¸€æ¬¡ä¸»åŠ¨flushæœŸé—´æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œåˆ é™¤æ“ä½œåå¯¹åº”çš„åˆ é™¤ä¿¡æ¯ï¼Œå³åˆ é™¤ç»“ç‚¹Nodeå¯¹è±¡ï¼Œä¸ºäº†ä¾¿äºæè¿°ï¼Œæˆ‘ä»¬å‡è®¾ä¸€ä¸ªDWPTæ€»æ˜¯åªç”±ä¸€ä¸ªç›¸åŒçš„çº¿ç¨‹æ¥ç®¡ç†ï¼ˆä¸€ä¸ªDWPTå¦‚æœæ‰§è¡Œäº†ä¸€æ¬¡æ–‡æ¡£çš„å¢åˆ æ”¹æ“ä½œåï¼Œæ²¡æœ‰è§¦å‘è‡ªåŠ¨flushï¼Œé‚£ä¹ˆä¸‹æ¬¡å†æ¬¡æ‰§è¡Œæ–‡æ¡£çš„å¢åˆ æ”¹æ“ä½œæ—¶å¯èƒ½ä¼šç”±å¦ä¸€ä¸ªçº¿ç¨‹ç®¡ç†ï¼Œè§æ–‡ç« <a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/Index/2019/0628/%E6%96%87%E6%A1%A3%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%EF%BC%88%E4%BA%8C%EF%BC%89" >æ–‡æ¡£çš„å¢åˆ æ”¹ï¼ˆäºŒï¼‰<i class="fas fa-external-link-alt"></i></a>ï¼‰ã€‚</p>
<p>â€ƒâ€ƒæ¯ä¸ªDWPTå¯¹è±¡ä¸­æœ‰ä¸€ä¸ªç§æœ‰çš„DeleteSliceå¯¹è±¡ï¼ŒDeleteSliceçš„ç»“æ„å¾ˆç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>å›¾1ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/è½¯åˆ é™¤softDeletes/è½¯åˆ é™¤softDeletesï¼ˆä¸‰ï¼‰/1.png"  >
<p>â€ƒâ€ƒæ¯å½“ç”Ÿæˆä¸€ä¸ªæ–°çš„DWPTï¼ˆæ„å‘³ç€éšåä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ®µï¼‰ï¼ŒDWPTä¸­çš„DeleteSliceå¯¹è±¡ï¼ˆä¸ºäº†åŒºåˆ†å…¨å±€çš„DeleteSliceï¼Œæ•…æˆ‘ä»¬ç§°ä¹‹ä¸ºDWPTç§æœ‰çš„DeleteSliceå¯¹è±¡ï¼‰çš„sliceHeadä»¥åŠsliceTailä¼šåŒæ—¶è¢«èµ‹å€¼ä¸ºdeleteQueueä¸­æœ€åä¸€ä¸ªåˆ é™¤ç»“ç‚¹ï¼Œå¯ä»¥ç†è§£ä¸ºsliceHeadè·ŸsliceTailä½œä¸ºæŒ‡é’ˆæŒ‡å‘deleteQueueä¸­æœ€åä¸€ä¸ªåˆ é™¤ç»“ç‚¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>å›¾2ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/è½¯åˆ é™¤softDeletes/è½¯åˆ é™¤softDeletesï¼ˆä¸‰ï¼‰/2.png"  >
<p>â€ƒâ€ƒå›¾2ä¸­ï¼ŒdeleteQueueä¸­å·²ç»æœ‰äº†ä¸€ä¸ªåˆ é™¤ç»“ç‚¹TermNodeï¼Œå®ƒæ˜¯ç”±å…¶ä»–çº¿ç¨‹æ·»åŠ çš„ï¼Œå½“TheadAç®¡ç†ä¸€ä¸ªæ–°ç”Ÿæˆçš„DWPTæ—¶ï¼Œé‚£ä¹ˆåœ¨åˆå§‹åŒ–DWPTé˜¶æ®µï¼ŒDWPTä¸­çš„DeleteSliceå¯¹è±¡çš„sliceHeadä»¥åŠsliceTailä¼šæŒ‡å‘deleteQueueä¸­çš„æœ€åä¸€ä¸ªåˆ é™¤ç»“ç‚¹ï¼Œå³ä¸Šå›¾ä¸­çš„TermNodeã€‚</p>
<p>â€ƒâ€ƒ<strong>ä¸ºä»€ä¹ˆsliceHeadä»¥åŠsliceTailè¦æŒ‡å‘deleteQueueä¸­çš„æœ€åä¸€ä¸ªç»“ç‚¹ï¼š</strong></p>
<p>â€ƒâ€ƒè¿™ä¹ˆåšçš„ç›®çš„æ˜¯ä¿è¯æ—§çš„åˆ é™¤æ“ä½œä¸ä¼šé”™è¯¯çš„ä½œç”¨ï¼ˆapplyï¼‰åˆ°æ–°çš„æ®µï¼ˆDWPTæœ€ç»ˆä¼šflushä¸ºä¸€ä¸ªæ®µï¼‰ï¼Œæ³¨æ„çš„æ˜¯åœ¨flushé˜¶æ®µæ€»æ˜¯ä»sliceHeadæŒ‡å‘çš„åˆ é™¤ç»“ç‚¹çš„<strong>ä¸‹ä¸€ä¸ªç»“ç‚¹</strong>å¼€å§‹è¯»å–ï¼Œæ•…å›¾2ä¸­çš„DWPTç”Ÿæˆçš„æ®µä¸ä¼šè¢«ä¸Šå›¾ä¸­TermNodeè¿™ä¸ªåˆ é™¤ä¿¡æ¯ä½œç”¨ã€‚</p>
<p>â€ƒâ€ƒå¦å¤–è¿˜å­˜åœ¨ä¸€ä¸ªå…¨å±€deleteSliceï¼Œå®ƒçš„sliceHeadä»¥åŠsliceTail**æ€»æ˜¯åˆ†åˆ«æŒ‡å‘ï¼ˆåœ¨å®Œå–„åˆ é™¤ç»“ç‚¹ä¹‹å‰ï¼‰**deleteQueueä¸­çš„ç¬¬ä¸€ä¸ªä»¥åŠæœ€åä¸€ä¸ªåˆ é™¤ç»“ç‚¹ï¼Œå…¨å±€deleteSliceçš„ä½œç”¨å°†åœ¨ä¸‹æ–‡ä¸­ä¸­ä»‹ç»ã€‚</p>
<p>â€ƒâ€ƒ<strong>åœ¨å®Œå–„åˆ é™¤ç»“ç‚¹çš„å‰åå…¨å±€deleteSliceçš„sliceHeadä»¥åŠsliceTailæœ‰ä»€ä¹ˆåŒºåˆ«ï¼š</strong></p>
<p>â€ƒâ€ƒåœ¨æ–‡ç« <a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/Index/2020/0621/%E8%BD%AF%E5%88%A0%E9%99%A4softDeletes%EF%BC%88%E4%BA%8C%EF%BC%89" >è½¯åˆ é™¤softDeletesï¼ˆäºŒï¼‰<i class="fas fa-external-link-alt"></i></a>ä¸­æˆ‘ä»¬è¯´åˆ°ï¼Œåˆ é™¤ç»“ç‚¹åœ¨è¢«**å®Œå–„ï¼ˆæ·»åŠ å“¨å…µå€¼ï¼Œè§æ–‡ç« <a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/Index/2019/0704/%E6%96%87%E6%A1%A3%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%EF%BC%88%E5%9B%9B%EF%BC%89" >æ–‡æ¡£çš„å¢åˆ æ”¹ï¼ˆå››ï¼‰<i class="fas fa-external-link-alt"></i></a>ï¼‰**åä½¿ç”¨æ–°çš„å®¹å™¨æ¥å­˜å‚¨ï¼Œåœ¨æºç ä¸­çš„æè¿°å°±æ˜¯åˆ é™¤ä¿¡æ¯Nodeåœ¨è¢«å®Œå–„åç”¨BufferedUpdateå¯¹è±¡ï¼ˆæ–°çš„å®¹å™¨çš„æ˜¯å¯¹è±¡æˆå‘˜ï¼Œè§åœ¨æ–‡ç« <a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/Index/2020/0621/%E8%BD%AF%E5%88%A0%E9%99%A4softDeletes%EF%BC%88%E4%BA%8C%EF%BC%89" >è½¯åˆ é™¤softDeletesï¼ˆäºŒï¼‰<i class="fas fa-external-link-alt"></i></a>ï¼‰æ¥å­˜å‚¨ã€‚</p>
<p>â€ƒâ€ƒ<strong>å…¨å±€deleteSliceä»€ä¹ˆæ—¶å€™ä¼šå‘ç”Ÿå®Œå–„åˆ é™¤ç»“ç‚¹ï¼š</strong></p>
<p>â€ƒâ€ƒåœ¨ç´¢å¼•æœŸé—´ï¼Œä»»æ„çº¿ç¨‹å¾€deleteQueueä¸­æ·»åŠ åˆ é™¤ç»“ç‚¹åå°±ä¼šæ‰§è¡Œå®Œå–„å…¨å±€deleteSliceå¯¹åº”çš„åˆ é™¤ç»“ç‚¹çš„æ“ä½œï¼Œåœ¨æºç ä¸­é€šè¿‡è°ƒç”¨tryApplyGlobalSlice()æ¥æ‰§è¡Œå®Œå–„åˆ é™¤ç»“ç‚¹çš„æ“ä½œï¼Œä»¥åŠåœ¨flushé˜¶æ®µä¹Ÿä¼šå‘ç”Ÿå®Œå–„åˆ é™¤ç»“ç‚¹çš„æ“ä½œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>å›¾3ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/è½¯åˆ é™¤softDeletes/è½¯åˆ é™¤softDeletesï¼ˆä¸‰ï¼‰/3.png"  >
<p>â€ƒâ€ƒå›¾3ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ¯æ¬¡æ‰§è¡Œä¸€æ¬¡æ·»åŠ åˆ é™¤ç»“ç‚¹çš„æ“ä½œåå°±ä¼š<strong>å°è¯•</strong>æ‰§è¡Œå®Œå–„åˆ é™¤ç»“ç‚¹ï¼Œé‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œä¸ºä»€ä¹ˆæ˜¯å°è¯•æ‰§è¡Œï¼Œè€Œä¸æ˜¯å¼ºåˆ¶æ‰§è¡Œï¼Œå¼ºåˆ¶æ‰§è¡Œæ„å‘³ç€ä»»æ„çº¿ç¨‹æ·»åŠ ä¸€ä¸ªåˆ é™¤ç»“ç‚¹éƒ½è¦å®Œå–„å…¨å±€deleteSliceå¯¹åº”çš„åˆ é™¤ç»“ç‚¹ã€‚</p>
<p>â€ƒâ€ƒ<strong>ä¸ºä»€ä¹ˆæ˜¯å°è¯•å®Œå–„åˆ é™¤ç»“ç‚¹ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶å®Œå–„åˆ é™¤ç»“ç‚¹ï¼š</strong></p>
<p>â€ƒâ€ƒåœ¨flushé˜¶æ®µï¼ŒdeleteQueueä¸­æ‰€æœ‰çš„åˆ é™¤ç»“ç‚¹éƒ½ä¼šè¢«å®Œå–„åˆ é™¤ç»“ç‚¹ï¼Œè¿™äº›åˆ é™¤ä¿¡æ¯çš„ä½œç”¨ï¼ˆapplyï¼‰å¯¹è±¡ä¸ºç´¢å¼•ç›®å½•ä¸­å·²ç»ç”Ÿæˆçš„æ®µï¼Œä¸ºäº†é˜²æ­¢äº§ç”Ÿé‡å¤çš„åˆ é™¤ä¿¡æ¯ï¼Œåªä¼šè®©ç¬¬ä¸€ä¸ªæ‰§è¡Œflushçš„DWPTåœ¨ç”Ÿæˆæ®µçš„æ—¶å€™å®Œå–„å…¨å±€deleteSliceå¯¹åº”çš„åˆ é™¤ç»“ç‚¹ï¼Œæ„å‘³ç€è¿™ä¸ªDWPTå¯¹åº”çš„çº¿ç¨‹ç›¸å¯¹äºå…¶ä»–çº¿ç¨‹ä¼šæœ‰é¢å¤–çš„è´Ÿæ‹…ï¼Œé‚£ä¹ˆå¦‚æœåœ¨ç´¢å¼•é˜¶æ®µï¼Œæ¯ä¸ªçº¿ç¨‹ç®¡ç†çš„DWPTåœ¨æ·»åŠ ä¸€ä¸ªåˆ é™¤ç»“ç‚¹åå°±å°è¯•å®Œå–„å…¨å±€deleteSliceå¯¹åº”çš„åˆ é™¤ç»“ç‚¹ï¼Œå°±èƒ½å‡è½»åœ¨flushé˜¶æ®µç¬¬ä¸€ä¸ªç”Ÿæˆæ®µå¯¹åº”çš„çº¿ç¨‹çš„å‹åŠ›ã€‚ç´¢å¼•æœŸé—´çš„åˆ é™¤ç»“ç‚¹æ“ä½œæ˜¯ä¸ªtryLockçš„åŒæ­¥æ“ä½œï¼Œæ‰€ä»¥å¦‚æœçº¿ç¨‹å°è¯•å®Œå–„å…¨å±€DeleteSliceå¯¹åº”çš„åˆ é™¤ç»“ç‚¹æ—¶å‘ç°å…¶ä»–çº¿ç¨‹æ­£åœ¨æ‰§è¡Œï¼Œé‚£ä¹ˆå°±è·³è¿‡æ­¤æ¬¡æ“ä½œã€‚å¦å¤–ä¸€ä¸ªæ›´é‡è¦çš„åŸå› æ˜¯ï¼Œæˆ‘ä»¬åœ¨æ–‡ç« <a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/Index/2019/0704/%E6%96%87%E6%A1%A3%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%EF%BC%88%E5%9B%9B%EF%BC%89" >æ–‡æ¡£çš„å¢åˆ æ”¹ï¼ˆå››ï¼‰<i class="fas fa-external-link-alt"></i></a>ä¸­çŸ¥é“ï¼Œå®Œå–„åˆ é™¤ç»“ç‚¹çš„ä¸»è¦ç›®çš„å°±æ˜¯æ·»åŠ å“¨å…µå€¼ï¼Œå“¨å…µå€¼ç”¨æ¥æè¿°åˆ é™¤ä¿¡æ¯çš„ä½œç”¨èŒƒå›´ï¼Œç„¶è€Œå…¨å±€DeleteSliceä¸­çš„çš„åˆ é™¤ä¿¡æ¯æ˜¯ç”¨æ¥ä½œç”¨ç´¢å¼•æ–‡ä»¶å·²ç»ç”Ÿæˆçš„æ®µçš„æ‰€æœ‰æ–‡æ¡£ï¼Œæ‰€ä»¥è¿™ä¸ªå“¨å…µå€¼æ˜¯ä¸ªå¸¸é‡ä¸º0x7fffffffï¼Œä»£è¡¨äº†æ‰€æœ‰çš„æ–‡æ¡£å·ï¼Œä½†æ˜¯å¯¹äºDWPTçš„DeleteSliceä¸­çš„åˆ é™¤ä¿¡æ¯ï¼Œå®ƒä»¬çš„ä½œç”¨ï¼ˆapplyï¼‰å¯¹è±¡æ˜¯DWPTå³å°†ç”Ÿæˆçš„æ®µä¸­çš„æ–‡æ¡£ï¼Œæ‰€ä»¥æ­¤æ—¶çš„å“¨å…µå€¼ä¸ºDWPTå½“å‰æ”¶é›†çš„æ–‡æ¡£æ•°é‡ï¼Œå³numDocsInRAMï¼ˆè§æ–‡ç« <a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/Index/2019/0704/%E6%96%87%E6%A1%A3%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%EF%BC%88%E5%9B%9B%EF%BC%89" >æ–‡æ¡£çš„å¢åˆ æ”¹ï¼ˆå››ï¼‰<i class="fas fa-external-link-alt"></i></a>ï¼‰ï¼Œä¸‹æ–‡ä¼šè¿›ä¸€æ­¥ä»‹ç»ã€‚</p>
<p>â€ƒâ€ƒå›¾2ä¸­ï¼Œå¦‚æœThreadAåœ¨æ·»åŠ äº†åˆ é™¤ç»“ç‚¹åæ‰§è¡Œäº†tryApplyGlobalSlice()çš„æ“ä½œï¼Œä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p>å›¾4ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/è½¯åˆ é™¤softDeletes/è½¯åˆ é™¤softDeletesï¼ˆä¸‰ï¼‰/4.png"  >
<p>â€ƒâ€ƒ<strong>ä¸ºäº†ä¾¿äºæè¿°ï¼Œæˆ‘ä»¬å‡è®¾åªæœ‰åœ¨flushé˜¶æ®µæ‰ä¼šå®Œå–„å…¨å±€DeleteSliceå¯¹åº”çš„åˆ é™¤ç»“ç‚¹ï¼Œæ•…ä¸‹æ–‡ä¸­ï¼Œå…¨å±€DeleteSliceä¸­çš„sliceHeadä»¥åŠsliceTailæ€»æ˜¯åˆ†åˆ«æŒ‡å‘deleteQueueä¸­ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªåˆ é™¤ç»“ç‚¹ã€‚</strong></p>
<p>â€ƒâ€ƒæ¥ç€å¦‚æœæ­¤æ—¶å›¾2ä¸­çš„DWPTæ‰§è¡Œä¸€ä¸ªåˆ é™¤æ“ä½œï¼Œé‚£ä¹ˆä¼šåœ¨deleteQueueä¸­æ·»åŠ ä¸€ä¸ªåˆ é™¤ç»“ç‚¹ï¼Œæˆ‘ä»¬å‡è®¾æ‰§è¡Œäº†<strong>è½¯åˆ é™¤çš„æ“ä½œ</strong>ï¼Œæ•…æ·»åŠ ä¸€ä¸ªDocValuesUpdatesNodeï¼Œå¹¶ä¸”è®©DWPTçš„ç§æœ‰DeleteSliceæŒ‡å‘**å®ƒæ·»åŠ çš„é‚£ä¸ªåˆ é™¤ç»“ç‚¹ï¼ˆè¿™é‡ŒåŠ é»‘çš„åŒºåŸŸå¾ˆé‡è¦ï¼Œä¸‹æ–‡ä¼šä»‹ç»ï¼‰**å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>å›¾5ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/è½¯åˆ é™¤softDeletes/è½¯åˆ é™¤softDeletesï¼ˆä¸‰ï¼‰/5.png"  >
<p>â€ƒâ€ƒåŒæ ·çš„åœ¨æ·»åŠ å®Œåˆ é™¤ç»“ç‚¹DocValuesUpdatesNodeä¹‹åï¼ŒThreadAç®¡ç†çš„DWPTåŒæ ·ä¼šå¯¹å®ƒåŒ…å«çš„DeleteSliceï¼Œå³ç§æœ‰DeleteSliceå¯¹åº”çš„åˆ é™¤èŠ‚ç‚¹æ‰§è¡Œå®Œå–„çš„æ“ä½œï¼Œé‚£ä¹ˆåœ¨åˆ é™¤ç»“ç‚¹DocValuesUpdatesNodeè¢«å®Œå–„åç”¨æ–°çš„å®¹å™¨æ¥å­˜å‚¨ï¼Œå³è¢«å­˜å‚¨åˆ°BufferedUpdateså¯¹è±¡ä¸­ï¼Œå¹¶ä¸”BufferedUpdateså¯¹è±¡æ˜¯DWPTçš„ç§æœ‰çš„ï¼ˆçœ‹ä¸æ‡‚ï¼Ÿå…ˆçœ‹ä¸‹æ–‡ç« <a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/Index/2019/0704/%E6%96%87%E6%A1%A3%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%EF%BC%88%E5%9B%9B%EF%BC%89" >æ–‡æ¡£çš„å¢åˆ æ”¹ï¼ˆå››ï¼‰<i class="fas fa-external-link-alt"></i></a>ï¼‰ï¼Œæœ€åæ›´æ–°DWPTçš„DeleteSliceçš„sliceHeadï¼Œè®©å®ƒæŒ‡å‘sliceTailæŒ‡å‘çš„åˆ é™¤ç»“ç‚¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>å›¾6ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/è½¯åˆ é™¤softDeletes/è½¯åˆ é™¤softDeletesï¼ˆä¸‰ï¼‰/6.png"  >
<p>â€ƒâ€ƒå¦‚æœæ­¤æ—¶çº¿ç¨‹ThreadBç®¡ç†ä¸€ä¸ªæ–°çš„DWPTï¼Œé‚£ä¹ˆDWPTåˆå§‹åŒ–ç»“æŸåï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>å›¾7ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/è½¯åˆ é™¤softDeletes/è½¯åˆ é™¤softDeletesï¼ˆä¸‰ï¼‰/7.png"  >
<p>â€ƒâ€ƒå›¾4ä¸­å¯ä»¥çœ‹å‡ºThreadAç®¡ç†çš„DWPTæ·»åŠ çš„åˆ é™¤ä¿¡æ¯ä¸ä¼šä½œç”¨åˆ°ThreadAç®¡ç†çš„DWPTå¯¹åº”çš„æ®µï¼Œåœ¨å¤šçº¿ç¨‹ä¸‹å¾€deleteQueueä¸­æ·»åŠ åˆ é™¤ç»“ç‚¹æ˜¯ä¸ªåŒæ­¥æ“ä½œï¼Œè¯¥åŒæ­¥é€šè¿‡synchronizeå®ç°ï¼Œåœ¨æºç ä¸­çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>å›¾8ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/è½¯åˆ é™¤softDeletes/è½¯åˆ é™¤softDeletesï¼ˆä¸‰ï¼‰/8.png"  >
<p>â€ƒâ€ƒå›¾7ä¸­é€šè¿‡synchronizedå…³é”®å­—å®ç°çº¿ç¨‹é—´çš„åŒæ­¥ï¼Œä¸Šå›¾ä¸­tailæ˜¯ä¸€ä¸ªå…¨å±€çš„Nodeç»“ç‚¹ï¼Œå®ƒæ€»æ˜¯deleteQueueä¸­æœ€åä¸€ä¸ªåˆ é™¤ç»“ç‚¹çš„å¼•ç”¨ï¼Œ<strong>å®ƒç”¨æ¥å‘ŠçŸ¥å…¶ä»–çš„çº¿ç¨‹ä»¥åŠå…¨å±€çš„DeleteSliceçš„sliceTailå¦‚ä½•æŒ‡å‘deleteQueueä¸­çš„æœ€åä¸€ä¸ªåˆ é™¤ç»“ç‚¹</strong>ã€‚</p>
<p>â€ƒâ€ƒä»å›¾7ä¸­æˆ‘ä»¬äº†è§£åˆ°ï¼Œå¤šçº¿ç¨‹æ‰§è¡Œæ·»åŠ åˆ é™¤ç»“ç‚¹æ“ä½œæ˜¯åŒæ­¥ï¼Œä½†æ˜¯æ¯ä¸ªçº¿ç¨‹åœ¨æ·»åŠ ç»“æŸåç´§æ¥ç€çš„å®Œå–„åˆ é™¤ç»“ç‚¹çš„æ“ä½œå´æ˜¯ä¸åŒæ­¥çš„ï¼Œä¾‹å¦‚ThreadAè·ŸThreadBç®¡ç†çš„DWPTåˆ†åˆ«æ·»åŠ äº†ä¸€ä¸ªTermNodeè·ŸDocValuesUpdatesNodeï¼Œå¹¶ä¸”æˆ‘ä»¬å‡è®¾<strong>TermNodeå…ˆè¢«æ·»åŠ äº†</strong>ï¼Œ<strong>å¹¶ä¸”ä¸¤ä¸ªçº¿ç¨‹éƒ½æ²¡æœ‰å¼€å§‹æ‰§è¡Œå®Œå–„åˆ é™¤ç»“ç‚¹çš„æ“ä½œ</strong>ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>å›¾9ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/è½¯åˆ é™¤softDeletes/è½¯åˆ é™¤softDeletesï¼ˆä¸‰ï¼‰/9.png"  >
<p>â€ƒâ€ƒä¸Šæ–‡ä¸­æˆ‘ä»¬è¯´åˆ°ï¼ŒDWPTå¾€deleteQueueä¸­æ·»åŠ äº†ä¸€ä¸ªåˆ é™¤ç»“ç‚¹åï¼Œä¼šè®©DWPTçš„ç§æœ‰DeleteSliceçš„sliceTailæŒ‡å‘å®ƒæ·»åŠ çš„é‚£ä¸ªåˆ é™¤ç»“ç‚¹ï¼Œæ•…å¦‚ä¸Šæ‰€ç¤ºã€‚</p>
<p>â€ƒâ€ƒåœ¨æ·»åŠ åˆ é™¤ç»“ç‚¹åˆ°deleteQueueä¸­ä¹‹åï¼Œæ¯ä¸ªçº¿ç¨‹ç®¡ç†çš„DWPTéƒ½éœ€è¦æ‰§è¡Œå®Œå–„ç»“ç‚¹çš„æ“ä½œï¼Œä»å›¾9ä¸­å¯ä»¥çœ‹å‡ºï¼Œç”±äºThreadAåœ¨æ·»åŠ åˆ é™¤ç»“ç‚¹çš„ç«äº‰ä¸­è·èƒœäº†ï¼Œæ‰€ä»¥åœ¨å®Œå–„åˆ é™¤ç»“ç‚¹åï¼Œåªæœ‰TermNodeä½œç”¨äºThreadAç®¡ç†çš„DWPTä¸­çš„æ–‡æ¡£ï¼Œè€Œå¯¹äºThreadBï¼Œåˆ™æ˜¯TermNodeè·ŸDocValuesUpdatesNodeä¸¤ä¸ªåˆ é™¤ä¿¡æ¯å°†ä½œç”¨äºThreadBç®¡ç†çš„DWPTä¸­çš„æ–‡æ¡£ï¼ŒåŒç†å¦‚æœåœ¨æ·»åŠ åˆ°deleteQueueçš„ç«äº‰ä¸­ï¼Œ<strong>ThreadBè·èƒœäº†</strong>ï¼Œé‚£ä¹ˆå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>å›¾10ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/è½¯åˆ é™¤softDeletes/è½¯åˆ é™¤softDeletesï¼ˆä¸‰ï¼‰/10.png"  >
<p>â€ƒâ€ƒä»å›¾10ä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“æ‰§è¡Œå®Œå–„åˆ é™¤ç»“ç‚¹åï¼ŒThreadBç®¡ç†çš„DWPTä¸­çš„æ–‡æ¡£å°†è¢«åªè¢«ä¸€ä¸ªDocValuesUpdatesNodeä½œç”¨ï¼Œè€ŒThreadAç®¡ç†çš„DWPTä¸­çš„æ–‡æ¡£å°†åªè¢«2ä¸ªåˆ é™¤ä¿¡æ¯ä½œç”¨ã€‚</p>
<p>â€ƒâ€ƒæˆ‘ä»¬æ­¤æ—¶è‚¯å®šä¼šäº§ç”Ÿä¸€ä¸ªç–‘é—®ï¼ˆå…¶å®è¿™ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡çœ‹è¿™æ®µæºç æ—¶çš„ç–‘æƒ‘ğŸ˜ï¼‰ï¼ŒæŒ‰ç…§ä¸Šæ–‡ä¸­çš„æè¿°ï¼ŒDWPTç”Ÿæˆçš„æ®µä¸­çš„åˆ é™¤ä¿¡æ¯æ˜¯æ— æ³•ç¡®å®šçš„ã€‚</p>
<p>â€ƒâ€ƒå…¶å®ä¸ç„¶ï¼Œæˆ‘ä»¬å…ˆæŠ›å‡ºç»“è®ºï¼šåœ¨<strong>DWPTåˆå§‹åŒ–ä¹‹å</strong>ï¼Œä¸‹æ¬¡ä¸»åŠ¨flushä¹‹å‰çš„æ‰€æœ‰<strong>æ–°å¢çš„åˆ é™¤ä¿¡æ¯</strong>ï¼ˆå¯èƒ½ç”±å…¶ä»–çº¿ç¨‹æä¾›çš„åˆ é™¤ä¿¡æ¯ï¼‰éƒ½ä¼šä½œç”¨åˆ°è¿™ä¸ªDWPTä¸­çš„æ–‡æ¡£ã€‚ä¹Ÿå°±æ˜¯è¯´å¯¹äºå›¾9è·Ÿå›¾10ä¸¤ç§æ·»åŠ åˆ é™¤ç»“ç‚¹çš„æƒ…å†µï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹ç®¡ç†çš„DWPTä¸­çš„æ–‡æ¡£æœ€ç»ˆéƒ½å°†è¢«TermNodeã€DocValuesUpdateNodeä½œç”¨ã€‚</p>
<p>â€ƒâ€ƒæˆ‘ä»¬ä»¥å›¾10çš„ThreadBä¸ºä¾‹ï¼Œç›®å‰å®ƒç®¡ç†çš„DWPTä¸­çš„æ–‡æ¡£åªè¢«DocValuesUpdatesNodeä½œç”¨ï¼ŒTermNodeå°†åœ¨ä¸‹é¢ä¸‰ç§æƒ…å†µä¸‹ä½œç”¨ï¼ˆapplyï¼‰</p>
<ul>
<li>æƒ…å†µä¸€ï¼šThreadBç®¡ç†çš„DWPTåˆæ·»åŠ äº†ä¸€æ¡åˆ é™¤ä¿¡æ¯ï¼Œå‡è®¾è¿™æ¡åˆ é™¤ä¿¡æ¯æ˜¯TermNodeï¼Œé‚£ä¹ˆåœ¨å®Œå–„ç»“ç‚¹æ—¶å°±èƒ½é€šè¿‡TheadBç®¡ç†çš„DWPTå¯¹åº”çš„DeleteSliceä¸­çš„sliceHeadä¸sliceTailæŒ‡å‘çš„åˆ é™¤ç»“ç‚¹åŒºé—´æ¥å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li>
</ul>
<p>å›¾11ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/è½¯åˆ é™¤softDeletes/è½¯åˆ é™¤softDeletesï¼ˆä¸‰ï¼‰/11.png"  >
<ul>
<li>
<p>æƒ…å†µäºŒï¼šThreadBç®¡ç†çš„DWPTæ·»åŠ äº†ä¸€ç¯‡æ–‡æ¡£ï¼Œåœ¨æ·»åŠ å®Œè¿™ç¯‡æ–‡æ¡£åï¼Œä¼šæ›´æ–°DWPTä¸­çš„DeleteSliceçš„sliceTailï¼Œè®©å®ƒæŒ‡å‘tailï¼ˆtailsçš„ä½œç”¨ä¸Šæ–‡å·²ç»ä»‹ç»ï¼‰ï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘deleteQueueä¸­æœ€åä¸€ä¸ªåˆ é™¤ç»“ç‚¹ï¼Œéšåæ‰§è¡Œå®Œå–„åˆ é™¤ç»“ç‚¹çš„æ“ä½œ</p>
</li>
<li>
<p>æƒ…å†µä¸‰ï¼šåœ¨flushé˜¶æ®µï¼ŒDWPTç”Ÿæˆä¸€ä¸ªæ®µæ—¶ï¼ŒThreadBç®¡ç†çš„DWPTå¯¹åº”çš„DeleteSliceä¸­çš„sliceTailå°†ä¼šè¢«æŒ‡å‘tailï¼Œè¿™æ ·æ‰€æœ‰å…¶ä»–çº¿ç¨‹æ–°å¢çš„åˆ é™¤ä¿¡æ¯éƒ½èƒ½è¢«ä½œç”¨åˆ°å½“å‰DWPTä¸­çš„æ–‡æ¡£ã€‚</p>
</li>
</ul>
<p>â€ƒâ€ƒæºç ä¸­æ˜¯è¿™æ ·ä»‹ç»åˆ é™¤ç»“ç‚¹ä½œç”¨DWPTä¸­çš„æ–‡æ¡£çš„æ—¶æœºç‚¹çš„ï¼š</p>
<p>å›¾12ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/è½¯åˆ é™¤softDeletes/è½¯åˆ é™¤softDeletesï¼ˆä¸‰ï¼‰/12.png"  >
<p>â€ƒâ€ƒå›¾12ä¸­è¯´åˆ°ï¼Œå½“DWPTå¤„ç†å®Œä¸€ç¯‡æ–‡æ¡£ä¹‹åï¼Œä¼šæ›´æ–°DWPTç§æœ‰çš„DeleteSliceï¼Œå¦‚æœè¿™æ¬¡çš„æ“ä½œæ˜¯æ›´æ–°æ“ä½œï¼Œå³å¸¦æœ‰åˆ é™¤ä¿¡æ¯ï¼Œé‚£ä¹ˆå°±é€šè¿‡add(Node, DeleteSlice)æ–¹æ³•ï¼Œå³ä¸Šæ–‡ä¸­çš„æƒ…å†µä¸€ï¼›å¦‚æœæ²¡æœ‰åˆ é™¤ä¿¡æ¯å°±è°ƒç”¨updateSlice(DeleteSlice)çš„æ–¹æ³•ï¼Œå³ä¸Šæ–‡ä¸­çš„æƒ…å†µäºŒã€‚</p>
<h2 id="ç»“è¯­"><a class="markdownIt-Anchor" href="#ç»“è¯­"></a> ç»“è¯­</h2>
<p>â€ƒâ€ƒç›¸ä¿¡é€šè¿‡ä¸Šæ–‡çš„ä»‹ç»ï¼Œèƒ½å®Œå…¨çš„ç†è§£Luceneåœ¨ç´¢å¼•é˜¶æ®µå¤„ç†åˆ é™¤ä¿¡æ¯çš„æ–¹å¼ï¼Œåœ¨åé¢çš„æ–‡ç« ä¸­æˆ‘ä»¬è¿˜ä¼šä»‹ç»åœ¨flushé˜¶æ®µè·Ÿåˆ é™¤ä¿¡æ¯ç›¸å…³çš„çŸ¥è¯†ï¼Œä¸ºäº†æ›´å¿«çš„ç†è§£ï¼Œå»ºè®®å…ˆé˜…è¯»ç³»åˆ—æ–‡ç« <a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/Index/2019/0716/%E6%96%87%E6%A1%A3%E6%8F%90%E4%BA%A4%E4%B9%8Bflush%EF%BC%88%E4%B8%80%EF%BC%89" >æ–‡æ¡£æäº¤ä¹‹flush<i class="fas fa-external-link-alt"></i></a>ã€‚</p>
<p><a class="link"   target="_blank" rel="noopener" href="http://www.amazingkoala.com.cn/attachment/Lucene/Index/%E8%BD%AF%E5%88%A0%E9%99%A4softDeletes/%E8%BD%AF%E5%88%A0%E9%99%A4softDeletes%EF%BC%88%E4%B8%89%EF%BC%89/%E8%BD%AF%E5%88%A0%E9%99%A4softDeletes%EF%BC%88%E4%B8%89%EF%BC%89.zip" >ç‚¹å‡»<i class="fas fa-external-link-alt"></i></a>ä¸‹è½½é™„ä»¶</p>

                </div>
                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/delete/">delete</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/softDeletes/">softDeletes</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                            <div class="post-share-container border-box">
    <ul class="share-list-wrap border-box">
        <li class="qq share-item border-box flex-center tooltip"
            data-tooltip-content="Share to QQ"
        >
            <i class="fa-brands fa-qq"></i>
        </li>
        <li class="wechat share-item border-box flex-center tooltip tooltip-img"
            data-tooltip-content="Share to WeChat"
            data-tooltip-img-tip="Scan by WeChat"
            data-tooltip-img-style="background-color: #fff; top: -10px; padding: 0.6rem 0.6rem 0.1rem 0.6rem;"
        >
            <i class="fa-brands fa-weixin"></i>
        </li>
        <li class="weibo share-item border-box flex-center tooltip"
            data-tooltip-content="Share to WeiBo"
        >
            <i class="fa-brands fa-weibo"></i>
        </li>
    </ul>
</div>

                        
                    </div>
                </div>

                
                    <div class="reward-author-container border-box flex-center">
    <div class="reward-btn keep-button border-box flex-center tooltip tooltip-img"
            data-tooltip-content="Buy me a coffee"
            data-tooltip-img-url="/images/buymeacoffee.jpg"
            data-tooltip-img-trigger="click"
            data-tooltip-img-style="top: -8px;"
    >
        <i class="fa-solid fa-hand-holding-heart"></i>
    </div>
</div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/Lucene/Index/2020/0629/%E8%BD%AF%E5%88%A0%E9%99%A4softDeletes%EF%BC%88%E5%9B%9B%EF%BC%89/"
                                   title="è½¯åˆ é™¤softDeletesï¼ˆå››ï¼‰ï¼ˆLucene 8.4.0ï¼‰"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">è½¯åˆ é™¤softDeletesï¼ˆå››ï¼‰ï¼ˆLucene 8.4.0ï¼‰</span>
                                        <span class="post-nav-item">Prev posts</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/Lucene/Index/2020/0621/%E8%BD%AF%E5%88%A0%E9%99%A4softDeletes%EF%BC%88%E4%BA%8C%EF%BC%89/"
                                   title="è½¯åˆ é™¤softDeletesï¼ˆäºŒï¼‰ï¼ˆLucene 8.4.0ï¼‰"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">è½¯åˆ é™¤softDeletesï¼ˆäºŒï¼‰ï¼ˆLucene 8.4.0ï¼‰</span>
                                        <span class="post-nav-item">Next posts</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    


    <div class="comments-container border-box">
        <div id="comments-anchor" class="comment-area-title border-box">
            <i class="fas fa-comments"></i>&nbsp;Comments
        </div>
        <div class="comment-plugin-fail border-box">
    <span class="fail-tip">Comment plugin failed to load</span>
    <button class="reload keep-button">Click to reload</button>
</div>
<div class="comment-plugin-loading flex-center border-box">
    <i class="loading-icon fa-solid fa-spinner fa-spin"></i>
    <span class="load-tip">Loading comment plugin</span>
</div>
<script data-pjax>
  window.KeepCommentPlugin = {}
  window.KeepCommentPlugin.hideLoading = () => {
    const cplDom = document.querySelector('.comments-container .comment-plugin-loading')
    cplDom.style.display = 'none'
  }
  window.KeepCommentPlugin.loadFailHandle = () => {
    window.KeepCommentPlugin.hideLoading()
    const cpfDom = document.querySelector('.comments-container .comment-plugin-fail')
    cpfDom.style.display = 'flex'
    cpfDom.querySelector('.reload').addEventListener('click', () => {
      window.location.reload()
    })
  }
</script>

        
            

    <div class="giscus-comments-container">
        <div class="giscus" id="giscus"></div>
        <script 
                onerror="window.KeepCommentPlugin.loadFailHandle()"
        >
          if (!window.KeepCommentPlugin?.getGiscusTheme) {
            window.KeepCommentPlugin.getGiscusTheme = () => {
              return document.documentElement.classList.contains('dark-mode') ? 'dark_dimmed' : 'light_tritanopia'
            }
          }

          if (!window.KeepCommentPlugin?.changeGiscusTheme) {
            window.KeepCommentPlugin.changeGiscusTheme = () => {
              const iframe = document.querySelector('iframe.giscus-frame')
              iframe && iframe.contentWindow.postMessage({
                giscus: {
                  setConfig: {
                    theme: window.KeepCommentPlugin.getGiscusTheme()
                  }
                }
              }, 'https://giscus.app')
            }
          }

          if (!window.KeepCommentPlugin?.initGiscus) {
            window.KeepCommentPlugin.initGiscus = () => {
              const script = document.createElement('script')
              script.async = true
              script.src = 'https://giscus.app/client.js'
              script.setAttribute('data-repo', 'LuXugang/luxugang.github.io')
              script.setAttribute('data-repo-id', 'R_kgDOKY7V7g')
              script.setAttribute('data-category', 'Announcements')
              script.setAttribute('data-category-id', 'DIC_kwDOKY7V7s4CaCS9')
              script.setAttribute('data-reactions-enabled', '0')
              script.setAttribute('data-lang', 'en')
              script.setAttribute('data-mapping', 'pathname')
              script.setAttribute('data-strict', '0')
              script.setAttribute('data-emit-metadata', '0')
              script.setAttribute('data-input-position', 'top')
              script.setAttribute('crossorigin', 'anonymous')
              script.setAttribute('loading', 'lazy')
              script.setAttribute('data-theme', window.KeepCommentPlugin.getGiscusTheme())
              document.querySelector('.giscus-comments-container').appendChild(script)
              script.onerror = () => {
                window.KeepCommentPlugin.loadFailHandle()
              }
              script.onload = () => {
                window.KeepCommentPlugin.hideLoading()
              }
              const toggleThemeBtn = document.querySelector('.tool-toggle-theme-mode')
              toggleThemeBtn && toggleThemeBtn.addEventListener('click', () => {
                window.KeepCommentPlugin.changeGiscusTheme()
              })
            }
          }

          if ('false' === "true") {
            setTimeout(() => {
              window.KeepCommentPlugin.initGiscus()
            }, 1000)
          } else {
            window.addEventListener("DOMContentLoaded", window.KeepCommentPlugin.initGiscus)
          }
        </script>
    </div>


        
    </div>





                
            </div>
        </div>

        
            <div class="pc-post-toc left-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <!-- use hexo-blog-encrypt -->
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%88%A0%E9%99%A4%E7%BB%93%E7%82%B9%E5%88%B0%E5%85%A8%E5%B1%80deletequeue"><span class="nav-number">1.</span> <span class="nav-text"> æ·»åŠ åˆ é™¤ç»“ç‚¹åˆ°å…¨å±€deleteQueue</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E8%AF%AD"><span class="nav-number">2.</span> <span class="nav-text"> ç»“è¯­</span></a></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
        &copy;&nbsp;<span>2018</span>&nbsp;-&nbsp;2024
        
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">Lu Xugang</a>
        
    </div>

    <div class="theme-info info-item">
        Powered by&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;&&nbsp;Theme&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div>

    
        
        <div class="deploy-info info-item">
            
            This site is deployed on <span class="tooltip" data-tooltip-content="GitHub Pages"><img src="/images/brands/github.png"></span>
            
        </div>
    

    
        <div class="count-info info-item">
            
                <span class="count-item border-box word">
                    <span class="item-type border-box">Total words</span>
                    <span class="item-value border-box word">319.8k</span>
                </span>
            

            
                <span class="count-item border-box uv">
                    <span class="item-type border-box">Unique Visitor</span>
                    <span class="item-value border-box uv" id="busuanzi_value_site_uv"></span>
                </span>
            

            
        </div>
    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools left-toc">
            <div class="post-tools-container border-box">
    <ul class="tools-list border-box">
        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        
            <li class="tools-item flex-center go-to-comments">
                <i class="fas fa-comment"></i>
                <span class="post-comments-count"></span>
            </li>
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-toggle-theme-mode flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        
            <li class="tools-item go-to-comments-tablet flex-center">
                <i class="fas fa-comment"></i>
            </li>
        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <!-- use hexo-blog-encrypt -->
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%88%A0%E9%99%A4%E7%BB%93%E7%82%B9%E5%88%B0%E5%85%A8%E5%B1%80deletequeue"><span class="nav-number">1.</span> <span class="nav-text"> æ·»åŠ åˆ é™¤ç»“ç‚¹åˆ°å…¨å±€deleteQueue</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E8%AF%AD"><span class="nav-number">2.</span> <span class="nav-text"> ç»“è¯­</span></a></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>



<!-- common -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/toggle-theme.js"></script>

<script src="/js/code-block.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local-search -->

    
<script src="/js/local-search.js"></script>



<!-- lazyload -->


<div class="">
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        
            
<script src="/js/post/toc.js"></script>

        

        <!-- copyright-info -->
        

        <!-- share -->
        
            
<script src="/js/post/share.js"></script>

        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



</body>
</html>
