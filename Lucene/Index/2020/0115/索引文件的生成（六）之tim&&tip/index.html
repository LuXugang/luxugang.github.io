<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Lu Xugang">
    
    <title>
        
            ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆå…­ï¼‰ä¹‹tim&amp;&amp;tip |
        
        Lu Xugangçš„å°å±‹
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/logo.svg">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en","path":"search.json"}
    KEEP.theme_config = {"base_info":{"title":"Lu Xugangçš„å°å±‹","author":"Lu Xugang","primary_color":"#0066cc","logo":"/images/koala.jpg","favicon":"/images/logo.svg","avatar":"/images/luxugang.jpg"},"first_screen":{"enable":true,"header_transparent":true,"background_img":"/images/bg.svg","description":"æ˜æœˆå‡ æ—¶æœ‰ æŠŠé…’é—®é’å¤©||ä¸çŸ¥é“å¤©ä¸Šå®«é˜™ ä»Šå¤•æ˜¯ä½•å¹´","hitokoto":false},"scroll":{"progress_bar":true,"percent":false},"menu":{"é¦–é¡µ":"/","å½’æ¡£":"/archives","æ ‡ç­¾":"/tags","åˆ†ç±»":"/categories","å…³äº":"/about"},"social_contact":{"enable":true,"links":{"github":"https://github.com/LuXugang","weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":"https://twitter.com/luxugang87","facebook":null,"email":"luxugang@apache.org"}},"home":{"announcement":"æ–‡ç« å†…çš„æ ‡é¢˜æ€ä¹ˆéƒ½é å³å¯¹é½æ˜¾ç¤ºäº†ï¼Œè¿™æ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ","category":true,"tag":true,"post_datetime":"created","post_datetime_format":"YYYY-MM-DD HH:mm:ss"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":true,"min2read":false},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":false,"share":true,"reward":{"enable":true,"img_link":"/images/buymeacoffee.jpg","text":"Buy me a coffee"}},"code_block":{"tools":{"enable":true,"style":"mac"},"highlight_theme":"obsidian"},"toc":{"enable":true,"number":true,"expand_all":false,"init_open":true,"layout":"left"},"website_count":{"busuanzi_count":{"enable":true,"site_uv":true,"site_pv":"ture","page_pv":true}},"local_search":{"enable":true,"preload":true},"comment":{"enable":true,"use":"giscus","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":"luxugang","github_admins":null,"repository":"luxugang-comments","client_id":"854bbd89fef1537d3af5","client_secret":"dc309b20e38535d86307f485f575855a93bf766b","proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.36"},"waline":{"server_url":null,"reaction":false,"version":"3.2.1"},"giscus":{"repo":"LuXugang/luxugang.github.io","repo_id":"R_kgDOKY7V7g","category":"Announcements","category_id":"DIC_kwDOKY7V7s4CaCS9","reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":false},"cdn":{"enable":false,"provider":"jsdelivr"},"pjax":{"enable":false},"footer":{"since":2018,"word_count":true,"icp":{"enable":true,"record_code":"è‹ICPå¤‡18064214å·-1","url":"https://beian.miit.gov.cn"},"site_deploy":{"enable":true,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":false,"css":[null],"js":[null]},"root":"","source_data":{},"version":"4.1.3"}
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"}
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"}
    KEEP.language_copy_copyright = {"copy":"Copy copyright info","copied":"Copied","title":"Original post title","author":"Original post author","link":"Original post link"}
  </script>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/koala.jpg">
                </a>
            
            <a class="site-name border-box" href="/">
               Lu Xugangçš„å°å±‹
            </a>
        </div>

        <div class="right border-box">
            <div class="pc">
                <ul class="menu-list">
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                
                                é¦–é¡µ
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                
                                å½’æ¡£
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                
                                æ ‡ç­¾
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                
                                åˆ†ç±»
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                
                                å…³äº
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/"
                    >é¦–é¡µ</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives"
                    >å½’æ¡£</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags"
                    >æ ‡ç­¾</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories"
                    >åˆ†ç±»</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about"
                    >å…³äº</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆå…­ï¼‰ä¹‹tim&amp;&amp;tip
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/luxugang.jpg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">Lu Xugang</span>
                                
                                    <span class="author-badge">Lv6</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2020-01-15 00:00:00</span>
            </span>

            <span class="meta-info-item post-update-date">
                <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                <span class="datetime" data-updated="Wed Oct 11 2023 11:10:25 GMT+0800">2023-10-11 11:10:25</span>
            </span>
        

        
            <span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="post-category-ul">
                    
                            <li class="category-item"><a href="/categories/Lucene/">Lucene</a></li>
                        
                    
                            <li class="category-item">&nbsp;<i class="icon fas fa-angle-right"></i>&nbsp;<a href="/categories/Lucene/Index/">Index</a></li>
                        
                    
                </ul>
            </span>
        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/tim/">tim</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/tip/">tip</a></li>
                        
                    
                </ul>
            </span>
        

        
        
            <span class="meta-info-item post-wordcount">
                <i class="icon fas fa-file-word"></i>&nbsp;<span>2.5k Words</span>
            </span>
        
        
        
            <span class="meta-info-item post-pv">
                <i class="icon fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
            </span>
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    <p>â€ƒâ€ƒæœ¬æ–‡æ‰¿æ¥<a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/Index/2020/0110/%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6%E7%9A%84%E7%94%9F%E6%88%90%EF%BC%88%E5%85%AD%EF%BC%89%E4%B9%8Btim&amp;&amp;tip" >ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆäº”ï¼‰<i class="fas fa-external-link-alt"></i></a>ç»§ç»­ä»‹ç»å‰©ä½™çš„å†…å®¹ï¼Œä¸‹é¢å…ˆç»™å‡ºç”Ÿæˆç´¢å¼•æ–‡ä»¶.timã€.tipçš„æµç¨‹å›¾ã€‚</p>
<h2 id="ç”Ÿæˆç´¢å¼•æ–‡ä»¶tim-tipçš„æµç¨‹å›¾"><a class="markdownIt-Anchor" href="#ç”Ÿæˆç´¢å¼•æ–‡ä»¶tim-tipçš„æµç¨‹å›¾"></a> ç”Ÿæˆç´¢å¼•æ–‡ä»¶.timã€.tipçš„æµç¨‹å›¾</h2>
<p>å›¾1ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆ/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆå…­ï¼‰/1.png"  >
<p>â€ƒâ€ƒä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†æ‰§è¡Œ<code>ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªNodeBlock</code>çš„è§¦å‘æ¡ä»¶ï¼Œæœ¬æ–‡å°±å…¶å®ç°è¿‡ç¨‹å±•å¼€ä»‹ç»ï¼ŒåŒæ ·çš„ï¼Œä¸‹æ–‡ä¸­å‡ºç°çš„å¹¶ä¸”æ²¡æœ‰ä½œå‡ºè§£é‡Šçš„åè¯ï¼Œè¯´æ˜å·²ç»åœ¨æ–‡ç« <a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/Index/2020/0110/%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6%E7%9A%84%E7%94%9F%E6%88%90%EF%BC%88%E5%85%AD%EF%BC%89%E4%B9%8Btim&amp;&amp;tip" >ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆäº”ï¼‰<i class="fas fa-external-link-alt"></i></a>ä¸­ä»‹ç»ï¼Œä¸åœ¨æœ¬æ–‡ä¸­èµ˜è¿°ã€‚</p>
<h2 id="ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªnodeblockçš„æµç¨‹å›¾"><a class="markdownIt-Anchor" href="#ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªnodeblockçš„æµç¨‹å›¾"></a> ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªNodeBlockçš„æµç¨‹å›¾</h2>
<p>å›¾2ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆ/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆå…­ï¼‰/2.png"  >
<h3 id="pendingentryé›†åˆ"><a class="markdownIt-Anchor" href="#pendingentryé›†åˆ"></a> PendingEntryé›†åˆ</h3>
<p>å›¾3ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆ/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆå…­ï¼‰/3.png"  >
<p>â€ƒâ€ƒæˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­è¯´åˆ°ï¼Œtermæ ˆä¸­å­˜æ”¾äº†ä¸¤ç§ç±»å‹çš„ä¿¡æ¯ï¼šPendingTermå’ŒPendingBlockï¼Œå®ƒä»¬ä¸¤ä¸ªçš„ç±»å›¾å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>å›¾4ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆ/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆå…­ï¼‰/4.png"  >
<p>â€ƒâ€ƒæ•…å›¾2æµç¨‹å›¾çš„å‡†å¤‡æ•°æ®æ˜¯ä¸€ä¸ªPendingEntryé›†åˆï¼Œå®ƒå°±æ˜¯termæ ˆï¼ˆæœ¬äººå¯¹è¯¥é›†åˆçš„ç§°å‘¼ğŸ˜‚ï¼‰ï¼Œåœ¨æºç ä¸­å³pendingé“¾è¡¨ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> List&lt;PendingEntry&gt; pending = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>
<h3 id="ç”Ÿæˆä¸€ä¸ªæˆ–è€…å¤šä¸ªpendingblockåˆ°newblockä¸­"><a class="markdownIt-Anchor" href="#ç”Ÿæˆä¸€ä¸ªæˆ–è€…å¤šä¸ªpendingblockåˆ°newblockä¸­"></a> ç”Ÿæˆä¸€ä¸ªæˆ–è€…å¤šä¸ªPendingBlockåˆ°newBlockä¸­</h3>
<p>å›¾5ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆ/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆå…­ï¼‰/5.png"  >
<p>â€ƒâ€ƒåœ¨ä»‹ç»è¯¥æµç¨‹ç‚¹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸‹PendingBlockç±»ä¸­çš„ä¸€äº›ä¿¡æ¯ï¼ŒPendingBlockç±»çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<p>å›¾6ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆ/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆå…­ï¼‰/6.png"  >
<p>â€ƒâ€ƒç¬¬ä¸€æ¬¡æ‰§è¡Œå›¾2çš„æµç¨‹æ—¶ï¼ŒPendingEntryé›†åˆä¸­<strong>æ€»æ˜¯</strong>åªå­˜åœ¨PendingTermä¿¡æ¯ï¼Œé›†åˆä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ä»£è¡¨äº†ä¸€ä¸ªtermåŒ…å«çš„ä¿¡æ¯ï¼Œåœ¨æ‰§è¡Œå®Œå›¾2çš„æµç¨‹ä¹‹åï¼ŒPendingEntryé›†åˆä¸­çš„ä¿¡æ¯å°±è½¬åŒ–ä¸ºä¸€ä¸ªPendingBlockï¼ˆæˆ‘ä»¬è®°ä¸ºblock1ï¼‰ï¼Œå®ƒç”¨æ¥æè¿°å…·æœ‰ç›¸åŒå‰ç¼€çš„termé›†åˆçš„ä¿¡æ¯ï¼Œå¹¶ä¸”é‡æ–°æ·»åŠ åˆ°termæ ˆä¸­ï¼›å¦‚æœä¸‹ä¸€æ¬¡æ‰§è¡Œå›¾2çš„æµç¨‹æ—¶ï¼ŒPendingEntryé›†åˆä¸­åŒ…å«äº†PendingTermå’ŒPendingBlockï¼ˆblock1ï¼‰ä¸¤ç§ç±»å‹ä¿¡æ¯ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œå®Œå›¾2çš„æµç¨‹åï¼ŒPendingEntryé›†åˆä¸­çš„ä¿¡æ¯å°±ä¼šè½¬åŒ–ä¸ºä¸€ä¸ªæ–°çš„PendingBlockï¼ˆæˆ‘ä»¬è®°ä¸ºblock2ï¼‰ï¼Œç”±æ­¤å¯è§æ‰§è¡Œå›¾1çš„æµç¨‹ç‚¹<code>ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªNodeBlock</code>å®é™…æ˜¯é€šè¿‡<strong>åµŒå¥—</strong>çš„æ–¹å¼å°†æ‰€æœ‰termçš„ä¿¡æ¯è½¬åŒ–ä¸ºä¸€ä¸ªPendingBlockã€‚</p>
<p>â€ƒâ€ƒå›¾6ä¸­<font color=Red>çº¢æ¡†</font>æ ‡æ³¨çš„indexæè¿°çš„æ˜¯ä¸€ä¸ªPendingBlockè‡ªèº«çš„ä¿¡æ¯ï¼Œè€Œ<font color=Blue>è“æ¡†</font>æ ‡æ³¨çš„subIndicesæè¿°çš„æ˜¯è¯¥PendingBlockä¸­åµŒå¥—çš„PendingBlockä¿¡æ¯çš„é›†åˆï¼ˆå³æ¯ä¸€ä¸ªPendingBlockçš„indexä¿¡æ¯ï¼‰ï¼Œå¯¹äºblock1è·Ÿblock2æ¥è¯´ï¼Œblock2å¯¹è±¡ä¸­çš„subIndicesä¸­åŒ…å«äº†ä¸€æ¡ä¿¡æ¯ï¼Œè¯¥ä¿¡æ¯ä¸ºblock1ä¸­çš„indexä¿¡æ¯ï¼Œè‡³äºindexä¸­åŒ…å«äº†å…·ä½“å“ªäº›ä¿¡æ¯ï¼Œä¸‹æ–‡ä¸­ä¼šå±•å¼€ä»‹ç»ã€‚</p>
<p>â€ƒâ€ƒæˆ‘ä»¬å›åˆ°<code>ç”Ÿæˆä¸€ä¸ªæˆ–è€…å¤šä¸ªPendingBlockåˆ°newBlockä¸­</code>çš„æµç¨‹ç‚¹çš„ä»‹ç»ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆå¯èƒ½ä¼šç”Ÿæˆå¤šä¸ªPendingBlock</strong></p>
<p>â€ƒâ€ƒå¯¹äºå¾…å¤„ç†çš„PendingEntryé›†åˆï¼Œå®ƒåŒ…å«çš„ä¿¡æ¯æ•°é‡è‡³å°‘æœ‰minItemsInBlockä¸ªï¼ˆä¸ºä»€ä¹ˆä½¿ç”¨<strong>è‡³å°‘</strong>è¿™ä¸ªå‰¯è¯ï¼Œè§æ–‡ç« <a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/Index/2020/0110/%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6%E7%9A%84%E7%94%9F%E6%88%90%EF%BC%88%E5%85%AD%EF%BC%89%E4%B9%8Btim&amp;&amp;tip" >ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆäº”ï¼‰<i class="fas fa-external-link-alt"></i></a>ï¼‰ï¼Œå› ä¸ºè¿™æ˜¯å›¾2çš„æµç¨‹çš„è§¦å‘æ¡ä»¶ï¼Œå¦‚æœPendingEntryé›†åˆä¸­çš„æ•°é‡è¿‡å¤šï¼Œé‚£ä¹ˆéœ€è¦å¤„ç†ä¸ºå¤šä¸ªPendingBlockï¼Œè¿™ä¹ˆå¤„ç†çš„åŸå› ä»¥åŠå¤„ç†æ–¹å¼åœ¨æºç ä¸­ä¹Ÿç»™å‡ºäº†è§£é‡Šï¼Œè§ <a class="link"   target="_blank" rel="noopener" href="https://github.com/LuXugang/Lucene-7.5.0/blob/master/solr-7.5.0/lucene/core/src/java/org/apache/lucene/codecs/blocktree/BlockTreeTermsWriter.java" >https://github.com/LuXugang/Lucene-7.5.0/blob/master/solr-7.5.0/lucene/core/src/java/org/apache/lucene/codecs/blocktree/BlockTreeTermsWriter.java<i class="fas fa-external-link-alt"></i></a> ä¸­çš„ void writeBlocks(int prefixLength, int count)æ–¹æ³•ï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The count is too large for one block, so we must break it into &quot;floor&quot; blocks, where we record the leading label of the suffix of the first term in each floor block, so at search time we can jump to the right floor block.  We just use a naive greedy segmenter here: make a new floor block as soon as we have at least minItemsInBlock.  This is not always best: it often produces a too-small block as the final block:</span><br></pre></td></tr></table></figure>
<p>â€ƒâ€ƒä¸Šè¿°çš„æ³¨é‡Šå¤§æ„ä¸ºï¼šå¦‚æœä¸€ä¸ªblockå¤ªå¤§ï¼Œé‚£ä¹ˆå°±åˆ’åˆ†ä¸ºå¤šä¸ªfloor blockï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªfloor blockä¸­è®°å½•åç¼€çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä½œä¸ºleading labelï¼Œä½¿å¾—åœ¨æœç´¢é˜¶æ®µèƒ½é€šè¿‡å‰ç¼€ä»¥åŠleading labelç›´æ¥è·³è½¬åˆ°å¯¹åº”çš„floor blockï¼Œå¦å¤–æ¯ç”Ÿæˆä¸€ä¸ªfloor blockï¼Œè¯¥blockä¸­è‡³å°‘åŒ…å«äº†minItemsInBlockæ¡PendingEntryä¿¡æ¯ï¼Œè¿™ç§åˆ’åˆ†æ–¹å¼é€šå¸¸ä¼šä½¿å¾—æœ€åä¸€ä¸ªblockä¸­åŒ…å«çš„ä¿¡æ¯æ•°é‡è¾ƒå°‘ã€‚</p>
<p>â€ƒâ€ƒå¯¹äºä¸Šè¿°çš„æ³¨é‡Šæˆ‘ä»¬ä¼šæå‡ºä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>é—®é¢˜ä¸€ï¼šåˆ’åˆ†å‡ºä¸€ä¸ªfloor blockçš„è§„åˆ™æ˜¯ä»€ä¹ˆ</li>
<li>é—®é¢˜äºŒï¼šåœ¨æœç´¢é˜¶æ®µï¼Œå¦‚ä½•é€šè¿‡å‰ç¼€è·Ÿleading labelå¿«é€Ÿè·³è½¬åˆ°å¯¹åº”floor block</li>
</ul>
<p><strong>é—®é¢˜ä¸€ï¼šåˆ’åˆ†å‡ºä¸€ä¸ªfloor blockçš„è§„åˆ™æ˜¯ä»€ä¹ˆ</strong></p>
<p>â€ƒâ€ƒä½¿ç”¨ä¸‹é¢ä¸¤ä¸ªé˜ˆå€¼ä½œä¸ºåˆ’åˆ†å‚æ•°ï¼š</p>
<ul>
<li>minItemsInBlockï¼šé»˜è®¤å€¼ä¸º25</li>
<li>maxItemsInBlockï¼šé»˜è®¤å€¼ä¸º48ï¼Œå®ƒçš„å€¼å¯ä»¥è®¾å®šçš„èŒƒå›´å¦‚ä¸‹æ‰€ç¤ºï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">minItemsInBlock &lt; maxItemsInBlock &lt; <span class="number">2</span>*(minItemsInBlock-<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>â€ƒâ€ƒåˆ’åˆ†çš„è§„åˆ™ï¼šæ¯å¤„ç†å›¾3ä¸­PendingEntryé›†åˆä¸­Nä¸ªä¿¡æ¯ï¼Œå°±ç”Ÿæˆä¸€ä¸ªfloor blockï¼Œå…¶ä¸­Nå€¼ä¸å°äºminItemsInBlockï¼Œå¹¶ä¸”PendingEntryé›†åˆä¸­æœªå¤„ç†çš„ä¿¡æ¯ä¸å°äºmaxItemsInBlockï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>å›¾7ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆ/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆå…­ï¼‰/7.png"  >
<p>â€ƒâ€ƒéšåå°†floor blockä¸­åŒ…å«çš„PendingEntryä¿¡æ¯åˆ†åˆ«ç”ŸæˆPendingBlockï¼Œå¦‚æœPendingEntryé›†åˆä¸­çš„å…ƒç´ æ•°é‡æ²¡æœ‰è¾¾åˆ°åˆ’åˆ†æ¡ä»¶ï¼Œé‚£ä¹ˆè¿™äº›å…ƒç´ ä½œä¸ºä¸€ä¸ªblockï¼Œå¹¶ä¸”è·Ÿfloor blockä¸€æ ·ç”ŸæˆPendingBlockï¼Œè¿™ä¸¤ç§æƒ…å†µç”Ÿæˆçš„PendingBlockè¿˜æ˜¯æœ‰äº›å·®å¼‚ï¼Œå·®å¼‚æ€§ç”¨å›¾6ä¸­<font color=gray>é»‘ç°è‰²</font>æ ‡æ³¨çš„ä¸‰ä¸ªä¿¡æ¯æ¥åŒºåˆ†ï¼š</p>
<ul>
<li>prefixï¼šç›¸åŒå‰ç¼€ + leading labelï¼Œ<strong>æ‰€æœ‰blockçš„ç›¸åŒå‰ç¼€éƒ½æ˜¯ä¸€æ ·çš„</strong>ï¼Œå¦‚æœä¸æ˜¯floor blockç”Ÿæˆçš„PendingBlockå¯¹åº”çš„prefixçš„å€¼åªæœ‰ç›¸åŒå‰ç¼€ï¼Œå¯ä»¥çœ‹ä¸‹æºç ä¸­prefixçš„å®šä¹‰æ¥åŒºåˆ†ï¼š</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">final BytesRef prefix = new BytesRef(prefixLength + (hasFloorLeadLabel ? 1 : 0))</span><br></pre></td></tr></table></figure>
<p>â€ƒâ€ƒå¯è§å¦‚æœæ˜¯floor blockç”Ÿæˆçš„PendingBlockï¼Œprefixä¼šå¤šå‡ºä¸€ä¸ªå­—èŠ‚ï¼ŒèŠ‚ç”¨æ¥å­˜å‚¨leading labelã€‚</p>
<ul>
<li>isFloorï¼šå¸ƒå°”å€¼ï¼Œç”¨æ¥åŒºåˆ†æ˜¯å¦ä¸ºfloor block</li>
<li>floorLeadByteï¼šè¯¥å­—æ®µå³leading labelï¼Œå¦‚æœä¸æ˜¯floor blockç”Ÿæˆçš„PendingBlockï¼Œé‚£ä¹ˆè¯¥å€¼ä¸º -1</li>
</ul>
<p>â€ƒâ€ƒåœ¨ç”ŸæˆPendingBlockçš„è¿‡ç¨‹ä¸­ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å°†termä¿¡æ¯å†™å…¥åˆ°<a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/suoyinwenjian/2019/0401/%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6%E4%B9%8Btim&amp;&amp;tip" >ç´¢å¼•æ–‡ä»¶.tim<i class="fas fa-external-link-alt"></i></a>æ–‡ä»¶çš„è¿‡ç¨‹ï¼Œå³ç”ŸæˆNodeBlockçš„è¿‡ç¨‹ï¼Œå…¶ä¸­ä¸€ä¸ªblockï¼ˆhead blockæˆ–è€…floor blockï¼‰å¯¹åº”ç”Ÿæˆä¸€ä¸ªNodeBlockï¼Œä¸Šæ–‡ä¸­æˆ‘ä»¬è¯´åˆ°PendingEntryä¿¡æ¯å¯åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šPendingTermå’ŒPendingBlockï¼Œæ ¹æ®blockä¸­çš„ä¸åŒç±»å‹çš„PendingEntryï¼Œåœ¨ç´¢å¼•æ–‡ä»¶.timä¸­å†™å…¥çš„æ•°æ®ç»“æ„ä¹Ÿæ˜¯ä¸åŒçš„ã€‚</p>
<h4 id="blockä¸­åªåŒ…å«pendingterm"><a class="markdownIt-Anchor" href="#blockä¸­åªåŒ…å«pendingterm"></a> blockä¸­åªåŒ…å«PendingTerm</h4>
<p>å›¾8ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆ/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆå…­ï¼‰/8.png"  >
<p>â€ƒâ€ƒæ ¹æ®blockä¸­åŒ…å«çš„PendingEntryçš„ç±»å‹ï¼Œå¯ä»¥ç»†åŒ–çš„å°†<code>blockä¸­åªåŒ…å«PendingTerm</code>å¯¹åº”ç”Ÿæˆçš„NodeBlockç§°ä¸ºOuterNodeï¼Œ<code>blockä¸­è‡³å°‘åŒ…å«PendingBlock</code>ï¼ˆè‡³å°‘åŒ…å«PendingBlockæ„æ€æ˜¯åªåŒ…å«PendingBlockæˆ–è€…åŒæ—¶åŒ…å«PendingBlockä»¥åŠPendingTermï¼‰å¯¹åº”ç”Ÿæˆçš„NodeBlockç§°ä¸ºInnerNodeã€‚</p>
<p>â€ƒâ€ƒå›¾8ä¸­ï¼Œæ‰€æœ‰çš„å­—æ®µçš„å«ä¹‰å·²ç»åœ¨æ–‡ç« <a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/suoyinwenjian/2019/0401/%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6%E4%B9%8Btim&amp;&amp;tip" >ç´¢å¼•æ–‡ä»¶ä¹‹tim&amp;&amp;tip<i class="fas fa-external-link-alt"></i></a>ä»‹ç»ï¼Œä¸ä¸€ä¸€å±•å¼€ä»‹ç»ï¼Œè¿™é‡Œæ³¨æ„çš„æ˜¯<font color=Red>çº¢æ¡†</font>æ ‡æ³¨çš„8ä¸ªå­—æ®µæè¿°çš„æ˜¯ä¸€ä¸ªtermçš„ä¿¡æ¯ï¼Œè¯¥ä¿¡æ¯åœ¨ç”Ÿæˆ<a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/suoyinwenjian/2019/0324/%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6%E4%B9%8Bdoc" >ç´¢å¼•æ–‡ä»¶.doc<i class="fas fa-external-link-alt"></i></a>ã€<a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/suoyinwenjian/2019/0324/%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6%E4%B9%8Bpos&amp;&amp;pay" >posã€.pay<i class="fas fa-external-link-alt"></i></a>ä¹‹åï¼Œä½¿ç”¨IntBlockTermStateå°è£…è¿™äº›ä¿¡æ¯ï¼Œå¹¶ä¸”é€šè¿‡åšä¸ºå›¾1ä¸­çš„å‡†å¤‡æ•°æ®å­˜å‚¨åˆ°ç´¢å¼•æ–‡ä»¶.timä¸­ï¼Œè¿™8ä¸ªå­—æ®µçš„ä»‹ç»è§æ–‡ç« <a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/Index/2020/0110/%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6%E7%9A%84%E7%94%9F%E6%88%90%EF%BC%88%E4%BA%94%EF%BC%89%E4%B9%8Btim&amp;&amp;tip" >ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆäº”ï¼‰ä¹‹tim&amp;&amp;tip<i class="fas fa-external-link-alt"></i></a>ã€‚</p>
<p>â€ƒâ€ƒå½“outerNodeå†™å…¥åˆ°ç´¢å¼•æ–‡ä»¶.timä¹‹åï¼Œå®ƒåœ¨ç´¢å¼•æ–‡ä»¶ä¸­.timçš„èµ·å§‹ä½ç½®å°±ç”¨å›¾6çš„fpä¿¡æ¯æè¿°ï¼Œç”±äºblockä¸­å­˜åœ¨PendingTermï¼Œæ•…å›¾6ä¸­çš„hasTermsä¿¡æ¯è¢«ç½®ä¸ºtrueï¼Œè‡³æ­¤ï¼Œå›¾6ä¸­PendingBlockåŒ…å«çš„æ‰€æœ‰ä¿¡æ¯éƒ½å·²ç»ä»‹ç»å®Œæ¯•ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¹Ÿæ˜ç™½äº†PendingBlockçš„ä½œç”¨ï¼šç”¨æ¥æè¿°ä¸€ä¸ªNodeBlockçš„æ‰€æœ‰ä¿¡æ¯ã€‚</p>
<h4 id="blockä¸­è‡³å°‘åŒ…å«pendingblock"><a class="markdownIt-Anchor" href="#blockä¸­è‡³å°‘åŒ…å«pendingblock"></a> blockä¸­è‡³å°‘åŒ…å«PendingBlock</h4>
<p>â€ƒâ€ƒæˆ‘ä»¬ç»“åˆä¸€ä¸ªä¾‹å­æ¥ä»‹ç»è¿™ç§æƒ…å†µã€‚</p>
<p>å›¾9ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆ/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆå…­ï¼‰/9.png"  >
<p>â€ƒâ€ƒå¾…å¤„ç†çš„PendingEntryé›†åˆå¦‚å›¾9æ‰€ç¤ºï¼Œå…¶ä¸­é™¤äº†&quot;ab&quot;æ˜¯ä¸€ä¸ªPendingBlockï¼Œå…¶ä»–éƒ½æ˜¯PendingTermï¼Œå°†è¯¥PendingEntryé›†åˆç”Ÿæˆä¸€ä¸ªNodeBlockï¼Œå®ƒæ˜¯InnerNodeã€‚</p>
<p>å›¾10ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆ/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆå…­ï¼‰/10.png"  >
<p>â€ƒâ€ƒç”±å›¾10ä¸­<font color=Red>çº¢æ¡†</font>æ ‡æ³¨çš„ä¿¡æ¯æè¿°äº†PendingTermä»¥åŠPendingBlockå¯¹åº”çš„Suffixå­—æ®µçš„å·®å¼‚æ€§ï¼Œå¯¹äºPendingBlockï¼Œå®ƒå¯¹åº”çš„Suffixä¸­å¤šäº†ä¸€ä¸ªindexå­—æ®µï¼Œè¯¥å­—æ®µçš„å€¼å°±æ˜¯ä»¥&quot;ab&quot;ä¸ºå‰ç¼€çš„PendingBlockä¸­çš„fpä¿¡æ¯ï¼ˆå³å›¾6ä¸­çš„fpä¿¡æ¯ï¼‰ï¼Œå®ƒæè¿°äº†&quot;ab&quot;ä¸ºå‰ç¼€çš„PendingBlockå¯¹åº”çš„NodeBlockä¿¡æ¯åœ¨ç´¢å¼•æ–‡ä»¶.timä¸­çš„èµ·å§‹ä½ç½®ã€‚</p>
<p>â€ƒâ€ƒæœ€åæ ¹æ®å›¾7ä¸­åˆ’åˆ†åçš„blockåœ¨åˆ†åˆ«ç”ŸæˆPendingBlockä¹‹åï¼Œå°†è¿™äº›PendingBlockæ·»åŠ åˆ°é“¾è¡¨newBlockä¸­ï¼ŒnewBlockçš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> List&lt;PendingBlock&gt; newBlocks = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>
<p>â€ƒâ€ƒæ·»åŠ åˆ°é“¾è¡¨newBlockä¸­çš„ç›®çš„å°±æ˜¯ä¸ºä¸‹ä¸€ä¸ªæµç¨‹<code>åˆå¹¶PendingBlock</code>åšå‡†å¤‡çš„ã€‚</p>
<p><strong>é—®é¢˜äºŒï¼šåœ¨æœç´¢é˜¶æ®µï¼Œå¦‚ä½•é€šè¿‡å‰ç¼€è·Ÿleading labelå¿«é€Ÿè·³è½¬åˆ°å¯¹åº”floor block</strong></p>
<p>â€ƒâ€ƒåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä»‹ç»ç´¢å¼•æ–‡ä»¶.tipæ—¶å›ç­”è¯¥é—®é¢˜ã€‚</p>
<h3 id="æ‰€æœ‰pendingblockåˆå¹¶åˆ°ç¬¬ä¸€ä¸ªpendingblock"><a class="markdownIt-Anchor" href="#æ‰€æœ‰pendingblockåˆå¹¶åˆ°ç¬¬ä¸€ä¸ªpendingblock"></a> æ‰€æœ‰PendingBlockåˆå¹¶åˆ°ç¬¬ä¸€ä¸ªPendingBlock</h3>
<p>å›¾11ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆ/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆå…­ï¼‰/11.png"  >
<p>â€ƒâ€ƒåœ¨ä¸Šæ–‡ä¸­ï¼Œæ ¹æ®å›¾2ä¸­çš„PendingEntryé›†åˆï¼Œæˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ªæˆ–å¤šä¸ªPendingBlockï¼Œå¹¶ä¸”æ·»åŠ åˆ°äº†newBlockä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>å›¾12ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆ/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆå…­ï¼‰/12.png"  >
<p>â€ƒâ€ƒåœ¨å½“å‰æµç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†newBlockä¸­ç¬¬äºŒä¸ªPendingBlockå¼€å§‹åé¢æ‰€æœ‰çš„PendingBlockçš„ä¿¡æ¯åˆå¹¶åˆ°ç¬¬ä¸€ä¸ªPendingBlockä¸­ï¼Œåˆå¹¶çš„ä¿¡æ¯åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>floorLeadByte</li>
<li>fp</li>
<li>hasTerms</li>
</ul>
<p>â€ƒâ€ƒéšåå°†è¿™äº›ä¿¡æ¯å†™å…¥åˆ°<a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/yasuocunchu/2019/0220/35.html" >FST<i class="fas fa-external-link-alt"></i></a>ä¸­ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªPendingBlockä¸­çš„prefixå°†ä½œä¸ºFSTçš„inputValueï¼Œåˆå¹¶çš„ä¿¡æ¯ä½œä¸ºFSTçš„outValueã€‚inputValueã€outValueçš„æ¦‚å¿µè§æ–‡ç« <a class="link"   target="_blank" rel="noopener" href="https://www.amazingkoala.com.cn/Lucene/yasuocunchu/2019/0220/FST%EF%BC%88%E4%B8%80%EF%BC%89" >FSTç®—æ³•ï¼ˆä¸Šï¼‰<i class="fas fa-external-link-alt"></i></a>ï¼Œä¸èµ˜è¿°ï¼Œåˆå¹¶çš„ä¿¡æ¯çš„æ•°æ®ç»“æ„ï¼Œå³outValueï¼Œæ ¹æ®æ˜¯å¦åˆ’åˆ†ä¸ºfloor blockè¿˜æœ‰æ‰€åŒºåˆ«ï¼š</p>
<p>å›¾13ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆ/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆå…­ï¼‰/13.png"  >
<p>â€ƒâ€ƒå›¾13ä¸­ï¼Œå¦‚æœisFloorä¸ºfalseï¼Œè¯´æ˜æ²¡æœ‰å¯¹PendingEntryé›†åˆä¸­è¿›è¡Œåˆ’åˆ†ï¼Œå³newBlockä¸­åªæœ‰ä¸€ä¸ªPendingBlockï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦ä¿¡æ¯åˆå¹¶ï¼Œå¦‚æœisFloorä¸ºtrue</p>
<ul>
<li>fpï¼šè¯¥å€¼æè¿°äº†ç¬¬ä¸€ä¸ªblockä¸­åŒ…å«çš„termä¿¡æ¯åœ¨NodeBlockä¸­çš„èµ·å§‹ä½ç½®ï¼Œ<strong>ä¾‹å¦‚å›¾8ã€å›¾10ä¸­çš„EntryCountå­—æ®µçš„ä½ç½®</strong></li>
<li>hasTermsæ ‡å¿—ä½ï¼šè¯¥å€¼æè¿°äº†è¿™ä¸ªblockä¸­æ˜¯å¦è‡³å°‘åŒ…å«ä¸€ä¸ªPendingTerm</li>
<li>isFlooræ ‡å¿—ä½ï¼šè¯¥å€¼æè¿°äº†æ˜¯å¦åˆ’åˆ†äº†å¤šä¸ªfloor block</li>
<li>floorBLockNumberï¼šé™¤äº†ç¬¬ä¸€ä¸ªfloor blockï¼Œå‰©ä½™floor blockçš„æ•°é‡</li>
<li>FloorMetaDataï¼šä¸€ä¸ªfloor blockçš„ä¿¡æ¯
<ul>
<li>floorLeadByteï¼šå³ä¸Šæ–‡ä¸­è¯´åˆ°çš„leading label</li>
<li>fpDeltaï¼šæè¿°äº†å½“å‰floor blockåŒ…å«çš„termä¿¡æ¯åœ¨NodeBlockä¸­çš„èµ·å§‹ä½ç½®ï¼Œè¿™é‡Œå­˜å‚¨çš„æ˜¯ä¸ç¬¬ä¸€ä¸ªblockçš„fpçš„å·®å€¼</li>
</ul>
</li>
</ul>
<p>â€ƒâ€ƒå›¾12ä¸­ï¼Œå¦‚æœ<code>blockä¸­è‡³å°‘åŒ…å«PendingBlock</code>ï¼Œé‚£ä¹ˆå¯¹åº”PendingBlockä¸­çš„subIndicesä¸­çš„åˆå¹¶ä¿¡æ¯ä¹Ÿéœ€è¦å†™å…¥åˆ°FSTä¸­ã€‚</p>
<h3 id="åˆå¹¶åçš„pendingblockæ·»åŠ åˆ°termæ ˆ"><a class="markdownIt-Anchor" href="#åˆå¹¶åçš„pendingblockæ·»åŠ åˆ°termæ ˆ"></a> åˆå¹¶åçš„PendingBlockæ·»åŠ åˆ°termæ ˆ</h3>
<p>å›¾14ï¼š</p>
<img     src="http://www.amazingkoala.com.cn/uploads/lucene/index/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆ/ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆå…­ï¼‰/14.png"  >
<p>â€ƒâ€ƒæœ€ååˆå¹¶çš„PendingBlockæ·»åŠ åˆ°termæ ˆï¼Œç­‰å¾…è¢«åµŒå¥—åˆ°æ–°çš„PendingBlockä¸­ï¼Œæœ€ç»ˆï¼Œç»è¿‡å±‚å±‚çš„åµŒå¥—ï¼Œä¸€ä¸ªåŸŸä¸­äº§ç”Ÿçš„æ‰€æœ‰çš„PendingBlockéƒ½ä¼šè¢«åµŒå¥—åˆ°ä¸€ä¸ªPendingBlockä¸­ï¼Œè¯¥PendingBlockçš„indexä¿¡æ¯åœ¨åé¢çš„æµç¨‹ä¸­å°†ä¼šè¢«å†™å…¥åˆ°ç´¢å¼•æ–‡ä»¶.tipä¸­ã€‚</p>
<h2 id="ç»“è¯­"><a class="markdownIt-Anchor" href="#ç»“è¯­"></a> ç»“è¯­</h2>
<p>â€ƒâ€ƒåŸºäºç¯‡å¹…ï¼Œå‰©ä½™çš„å†…å®¹å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­å±•å¼€ã€‚</p>
<p><a class="link"   target="_blank" rel="noopener" href="http://www.amazingkoala.com.cn/attachment/Lucene/Index/%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6%E7%9A%84%E7%94%9F%E6%88%90/%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6%E7%9A%84%E7%94%9F%E6%88%90%EF%BC%88%E5%85%AD%EF%BC%89/%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6%E7%9A%84%E7%94%9F%E6%88%90%EF%BC%88%E5%85%AD%EF%BC%89.zip" >ç‚¹å‡»<i class="fas fa-external-link-alt"></i></a>ä¸‹è½½é™„ä»¶</p>

                </div>
                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/tim/">tim</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/tip/">tip</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                            <div class="post-share-container border-box">
    <ul class="share-list-wrap border-box">
        <li class="qq share-item border-box flex-center tooltip"
            data-tooltip-content="Share to QQ"
        >
            <i class="fa-brands fa-qq"></i>
        </li>
        <li class="wechat share-item border-box flex-center tooltip tooltip-img"
            data-tooltip-content="Share to WeChat"
            data-tooltip-img-tip="Scan by WeChat"
            data-tooltip-img-style="background-color: #fff; top: -10px; padding: 0.6rem 0.6rem 0.1rem 0.6rem;"
        >
            <i class="fa-brands fa-weixin"></i>
        </li>
        <li class="weibo share-item border-box flex-center tooltip"
            data-tooltip-content="Share to WeiBo"
        >
            <i class="fa-brands fa-weibo"></i>
        </li>
    </ul>
</div>

                        
                    </div>
                </div>

                
                    <div class="reward-author-container border-box flex-center">
    <div class="reward-btn keep-button border-box flex-center tooltip tooltip-img"
            data-tooltip-content="Buy me a coffee"
            data-tooltip-img-url="/images/buymeacoffee.jpg"
            data-tooltip-img-trigger="click"
            data-tooltip-img-style="top: -8px;"
    >
        <i class="fa-solid fa-hand-holding-heart"></i>
    </div>
</div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/Lucene/Index/2020/0117/%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6%E7%9A%84%E7%94%9F%E6%88%90%EF%BC%88%E4%B8%83%EF%BC%89%E4%B9%8Btim&&tip/"
                                   title="ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆä¸ƒï¼‰ä¹‹tim&amp;&amp;tip"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆä¸ƒï¼‰ä¹‹tim&amp;&amp;tip</span>
                                        <span class="post-nav-item">Prev posts</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/Lucene/Index/2020/0110/%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6%E7%9A%84%E7%94%9F%E6%88%90%EF%BC%88%E4%BA%94%EF%BC%89%E4%B9%8Btim&&tip/"
                                   title="ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆäº”ï¼‰ä¹‹tim&amp;&amp;tip"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">ç´¢å¼•æ–‡ä»¶çš„ç”Ÿæˆï¼ˆäº”ï¼‰ä¹‹tim&amp;&amp;tip</span>
                                        <span class="post-nav-item">Next posts</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    


    <div class="comments-container border-box">
        <div id="comments-anchor" class="comment-area-title border-box">
            <i class="fas fa-comments"></i>&nbsp;Comments
        </div>
        <div class="comment-plugin-fail border-box">
    <span class="fail-tip">Comment plugin failed to load</span>
    <button class="reload keep-button">Click to reload</button>
</div>
<div class="comment-plugin-loading flex-center border-box">
    <i class="loading-icon fa-solid fa-spinner fa-spin"></i>
    <span class="load-tip">Loading comment plugin</span>
</div>
<script data-pjax>
  window.KeepCommentPlugin = {}
  window.KeepCommentPlugin.hideLoading = () => {
    const cplDom = document.querySelector('.comments-container .comment-plugin-loading')
    cplDom.style.display = 'none'
  }
  window.KeepCommentPlugin.loadFailHandle = () => {
    window.KeepCommentPlugin.hideLoading()
    const cpfDom = document.querySelector('.comments-container .comment-plugin-fail')
    cpfDom.style.display = 'flex'
    cpfDom.querySelector('.reload').addEventListener('click', () => {
      window.location.reload()
    })
  }
</script>

        
            

    <div class="giscus-comments-container">
        <div class="giscus" id="giscus"></div>
        <script 
                onerror="window.KeepCommentPlugin.loadFailHandle()"
        >
          if (!window.KeepCommentPlugin?.getGiscusTheme) {
            window.KeepCommentPlugin.getGiscusTheme = () => {
              return document.documentElement.classList.contains('dark-mode') ? 'dark_dimmed' : 'light_tritanopia'
            }
          }

          if (!window.KeepCommentPlugin?.changeGiscusTheme) {
            window.KeepCommentPlugin.changeGiscusTheme = () => {
              const iframe = document.querySelector('iframe.giscus-frame')
              iframe && iframe.contentWindow.postMessage({
                giscus: {
                  setConfig: {
                    theme: window.KeepCommentPlugin.getGiscusTheme()
                  }
                }
              }, 'https://giscus.app')
            }
          }

          if (!window.KeepCommentPlugin?.initGiscus) {
            window.KeepCommentPlugin.initGiscus = () => {
              const script = document.createElement('script')
              script.async = true
              script.src = 'https://giscus.app/client.js'
              script.setAttribute('data-repo', 'LuXugang/luxugang.github.io')
              script.setAttribute('data-repo-id', 'R_kgDOKY7V7g')
              script.setAttribute('data-category', 'Announcements')
              script.setAttribute('data-category-id', 'DIC_kwDOKY7V7s4CaCS9')
              script.setAttribute('data-reactions-enabled', '0')
              script.setAttribute('data-lang', 'en')
              script.setAttribute('data-mapping', 'pathname')
              script.setAttribute('data-strict', '0')
              script.setAttribute('data-emit-metadata', '0')
              script.setAttribute('data-input-position', 'top')
              script.setAttribute('crossorigin', 'anonymous')
              script.setAttribute('loading', 'lazy')
              script.setAttribute('data-theme', window.KeepCommentPlugin.getGiscusTheme())
              document.querySelector('.giscus-comments-container').appendChild(script)
              script.onerror = () => {
                window.KeepCommentPlugin.loadFailHandle()
              }
              script.onload = () => {
                window.KeepCommentPlugin.hideLoading()
              }
              const toggleThemeBtn = document.querySelector('.tool-toggle-theme-mode')
              toggleThemeBtn && toggleThemeBtn.addEventListener('click', () => {
                window.KeepCommentPlugin.changeGiscusTheme()
              })
            }
          }

          if ('false' === "true") {
            setTimeout(() => {
              window.KeepCommentPlugin.initGiscus()
            }, 1000)
          } else {
            window.addEventListener("DOMContentLoaded", window.KeepCommentPlugin.initGiscus)
          }
        </script>
    </div>


        
    </div>





                
            </div>
        </div>

        
            <div class="pc-post-toc left-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <!-- use hexo-blog-encrypt -->
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6tim-tip%E7%9A%84%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="nav-number">1.</span> <span class="nav-text"> ç”Ÿæˆç´¢å¼•æ–‡ä»¶.timã€.tipçš„æµç¨‹å›¾</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E6%88%96%E5%A4%9A%E4%B8%AAnodeblock%E7%9A%84%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="nav-number">2.</span> <span class="nav-text"> ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªNodeBlockçš„æµç¨‹å›¾</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pendingentry%E9%9B%86%E5%90%88"><span class="nav-number">2.1.</span> <span class="nav-text"> PendingEntryé›†åˆ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E6%88%96%E8%80%85%E5%A4%9A%E4%B8%AApendingblock%E5%88%B0newblock%E4%B8%AD"><span class="nav-number">2.2.</span> <span class="nav-text"> ç”Ÿæˆä¸€ä¸ªæˆ–è€…å¤šä¸ªPendingBlockåˆ°newBlockä¸­</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#block%E4%B8%AD%E5%8F%AA%E5%8C%85%E5%90%ABpendingterm"><span class="nav-number">2.2.1.</span> <span class="nav-text"> blockä¸­åªåŒ…å«PendingTerm</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#block%E4%B8%AD%E8%87%B3%E5%B0%91%E5%8C%85%E5%90%ABpendingblock"><span class="nav-number">2.2.2.</span> <span class="nav-text"> blockä¸­è‡³å°‘åŒ…å«PendingBlock</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%80%E6%9C%89pendingblock%E5%90%88%E5%B9%B6%E5%88%B0%E7%AC%AC%E4%B8%80%E4%B8%AApendingblock"><span class="nav-number">2.3.</span> <span class="nav-text"> æ‰€æœ‰PendingBlockåˆå¹¶åˆ°ç¬¬ä¸€ä¸ªPendingBlock</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%88%E5%B9%B6%E5%90%8E%E7%9A%84pendingblock%E6%B7%BB%E5%8A%A0%E5%88%B0term%E6%A0%88"><span class="nav-number">2.4.</span> <span class="nav-text"> åˆå¹¶åçš„PendingBlockæ·»åŠ åˆ°termæ ˆ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E8%AF%AD"><span class="nav-number">3.</span> <span class="nav-text"> ç»“è¯­</span></a></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
        &copy;&nbsp;<span>2018</span>&nbsp;-&nbsp;2024
        
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">Lu Xugang</a>
        
    </div>

    <div class="theme-info info-item">
        Powered by&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;&&nbsp;Theme&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div>

    
        
        <div class="deploy-info info-item">
            
            This site is deployed on <span class="tooltip" data-tooltip-content="GitHub Pages"><img src="/images/brands/github.png"></span>
            
        </div>
    

    
        <div class="count-info info-item">
            
                <span class="count-item border-box word">
                    <span class="item-type border-box">Total words</span>
                    <span class="item-value border-box word">319.8k</span>
                </span>
            

            
                <span class="count-item border-box uv">
                    <span class="item-type border-box">Unique Visitor</span>
                    <span class="item-value border-box uv" id="busuanzi_value_site_uv"></span>
                </span>
            

            
        </div>
    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools left-toc">
            <div class="post-tools-container border-box">
    <ul class="tools-list border-box">
        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        
            <li class="tools-item flex-center go-to-comments">
                <i class="fas fa-comment"></i>
                <span class="post-comments-count"></span>
            </li>
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-toggle-theme-mode flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        
            <li class="tools-item go-to-comments-tablet flex-center">
                <i class="fas fa-comment"></i>
            </li>
        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <!-- use hexo-blog-encrypt -->
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6tim-tip%E7%9A%84%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="nav-number">1.</span> <span class="nav-text"> ç”Ÿæˆç´¢å¼•æ–‡ä»¶.timã€.tipçš„æµç¨‹å›¾</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E6%88%96%E5%A4%9A%E4%B8%AAnodeblock%E7%9A%84%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="nav-number">2.</span> <span class="nav-text"> ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªNodeBlockçš„æµç¨‹å›¾</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pendingentry%E9%9B%86%E5%90%88"><span class="nav-number">2.1.</span> <span class="nav-text"> PendingEntryé›†åˆ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E6%88%96%E8%80%85%E5%A4%9A%E4%B8%AApendingblock%E5%88%B0newblock%E4%B8%AD"><span class="nav-number">2.2.</span> <span class="nav-text"> ç”Ÿæˆä¸€ä¸ªæˆ–è€…å¤šä¸ªPendingBlockåˆ°newBlockä¸­</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#block%E4%B8%AD%E5%8F%AA%E5%8C%85%E5%90%ABpendingterm"><span class="nav-number">2.2.1.</span> <span class="nav-text"> blockä¸­åªåŒ…å«PendingTerm</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#block%E4%B8%AD%E8%87%B3%E5%B0%91%E5%8C%85%E5%90%ABpendingblock"><span class="nav-number">2.2.2.</span> <span class="nav-text"> blockä¸­è‡³å°‘åŒ…å«PendingBlock</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%80%E6%9C%89pendingblock%E5%90%88%E5%B9%B6%E5%88%B0%E7%AC%AC%E4%B8%80%E4%B8%AApendingblock"><span class="nav-number">2.3.</span> <span class="nav-text"> æ‰€æœ‰PendingBlockåˆå¹¶åˆ°ç¬¬ä¸€ä¸ªPendingBlock</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%88%E5%B9%B6%E5%90%8E%E7%9A%84pendingblock%E6%B7%BB%E5%8A%A0%E5%88%B0term%E6%A0%88"><span class="nav-number">2.4.</span> <span class="nav-text"> åˆå¹¶åçš„PendingBlockæ·»åŠ åˆ°termæ ˆ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E8%AF%AD"><span class="nav-number">3.</span> <span class="nav-text"> ç»“è¯­</span></a></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>



<!-- common -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/toggle-theme.js"></script>

<script src="/js/code-block.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local-search -->

    
<script src="/js/local-search.js"></script>



<!-- lazyload -->


<div class="">
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        
            
<script src="/js/post/toc.js"></script>

        

        <!-- copyright-info -->
        

        <!-- share -->
        
            
<script src="/js/post/share.js"></script>

        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



</body>
</html>
